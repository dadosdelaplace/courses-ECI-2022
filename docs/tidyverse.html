<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 19 Depuración y transformación | Analizando datos, visualizando información, contando historias</title>
<meta name="author" content="Javier Álvarez Liébana y Gabriel Valverde Castilla">
<meta name="description" content="Scripts usados: script19.R: introducción a tidyverse. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script19.R  De aquí en adelante intentaremos que nuestros datos...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Capítulo 19 Depuración y transformación | Analizando datos, visualizando información, contando historias">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/logo_R.png">
<meta property="og:description" content="Scripts usados: script19.R: introducción a tidyverse. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script19.R  De aquí en adelante intentaremos que nuestros datos...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 19 Depuración y transformación | Analizando datos, visualizando información, contando historias">
<meta name="twitter:description" content="Scripts usados: script19.R: introducción a tidyverse. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script19.R  De aquí en adelante intentaremos que nuestros datos...">
<meta name="twitter:image" content="/img/logo_R.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Sen-0.4.0/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/_Bitter-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.18/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analizando datos, visualizando información, contando historias</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Recursos</li>
<li><a class="" href="ejercicios-recopilados.html">📝 Ejercicios recopilados</a></li>
<li><a class="" href="recursos-de-aprendizaje.html">📚 Recursos de aprendizaje</a></li>
<li><a class="" href="pr%C3%A1cticas-evaluables.html">🏅 Prácticas evaluables</a></li>
<li class="book-part">Toma de contacto</li>
<li><a class="" href="requisitos.html"><span class="header-section-number">1</span> Requisitos</a></li>
<li><a class="" href="instalacion.html"><span class="header-section-number">2</span> Instalación</a></li>
<li><a class="" href="que-es-R.html"><span class="header-section-number">3</span> ¿Qué es R?</a></li>
<li><a class="" href="primeros-pasos.html"><span class="header-section-number">4</span> Primeros pasos</a></li>
<li class="book-part">Conceptos básicos</li>
<li><a class="" href="tipos-datos.html"><span class="header-section-number">5</span> Tipos de datos</a></li>
<li><a class="" href="vectores.html"><span class="header-section-number">6</span> Vectores</a></li>
<li><a class="" href="operacionesvectores.html"><span class="header-section-number">7</span> Operaciones con vectores</a></li>
<li><a class="" href="datos.html"><span class="header-section-number">8</span> Datos estructurados</a></li>
<li><a class="" href="repaso-1.html"><span class="header-section-number">9</span> Repaso: empezando a trastear con datos</a></li>
<li class="book-part">Haciendo el trabajo más fácil</li>
<li><a class="" href="if-else.html"><span class="header-section-number">10</span> Estructuras de control: if-else</a></li>
<li><a class="" href="bucles.html"><span class="header-section-number">11</span> Estructuras de control: bucles</a></li>
<li><a class="" href="proyecto.html"><span class="header-section-number">12</span> Primer proyecto de trabajo</a></li>
<li><a class="" href="funciones.html"><span class="header-section-number">13</span> Funciones</a></li>
<li><a class="" href="listas.html"><span class="header-section-number">14</span> Listas</a></li>
<li class="book-part">Empezando a explorar datos</li>
<li><a class="" href="tibble.html"><span class="header-section-number">15</span> Mejorando los data.frame: datos tibble</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">16</span> Tidy vs messy data: daticos ordenados</a></li>
<li><a class="" href="importar-exportar.html"><span class="header-section-number">17</span> Sacando datos de las piedras</a></li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">18</span> Contando los datos: rmarkdown</a></li>
<li class="book-part">Incursión a tidyverse</li>
<li><a class="active" href="tidyverse.html"><span class="header-section-number">19</span> Depuración y transformación</a></li>
<li><a class="" href="resumenes.html"><span class="header-section-number">20</span> Resumiendo y relacionado datos</a></li>
<li><a class="" href="tidyverse-2.html"><span class="header-section-number">21</span> Profundizando tidyverse: encuestas electorales</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">22</span> Visualizando datos: incursión a ggplot2</a></li>
<li><a class="" href="ggplot2_plus.html"><span class="header-section-number">23</span> Profundizando en ggplot2</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliografía</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/dadosdelaplace/courses-ECI-2022">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidyverse" class="section level1">
<h1>
<span class="header-section-number">Capítulo 19</span> Depuración y transformación<a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h1>
<div class="blackbox">
<p>Scripts usados:</p>
<ul>
<li>
<a href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script19.R"><strong>script19.R</strong></a>: introducción a tidyverse. Ver en <a href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script19.R" class="uri">https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script19.R</a>
</li>
</ul>
</div>
<ul>
<li>De aquí en adelante intentaremos que nuestros datos sean <a href="#tidy_data">Tidy data</a>
</li>
<li>Conocemos ya un <mark><strong>formato amable</strong></mark> de almacenar los datos como son los <code>data.frame</code> de tipo <code>tibble</code>
</li>
</ul>
<p>Como hemos comentado antes, muchas veces los datos no los tenemos en el formato deseado, o directamente queremos realizar algunas <mark><strong>transformaciones</strong></mark> en los mismos, crear nuevas variables u obtener resúmenes numéricos. En esta sección <strong>empezaremos a explorar, procesar, depurar y transformar los datos</strong>, haciendo uso principalmente del entorno de paquetes <a href="https://tidyverse.tidyverse.org">tidyverse</a>.</p>
<div class="sourceCode" id="cb1565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidyverse"></span>
<a href="https://sporella.github.io/datos_espaciales_presentacion/#30" target="_blank"><img src="img/flujo_tidyverse.png" alt="Imagen extraída de &lt;https://sporella.github.io/datos_espaciales_presentacion/#30&gt;" width="70%"></a>
<p class="caption">
Imagen/gráfica 19.1: Imagen extraída de <a href="https://sporella.github.io/datos_espaciales_presentacion/#30" class="uri">https://sporella.github.io/datos_espaciales_presentacion/#30</a>
</p>
</div>
<p>El <mark><strong>entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a></strong></mark> es una de las <strong>herramientas más importantes en el manejo de datos en <code>R</code></strong>, una <strong>colección de paquetes</strong> pensada para el manejo, la exploración, el análisis y la visualización de datos, compartiendo una <strong>misma filosofía y gramática</strong>.</p>
<div id="conjunto-starwars" class="section level2">
<h2>
<span class="header-section-number">19.1</span> Conjunto starwars<a class="anchor" aria-label="anchor" href="#conjunto-starwars"><i class="fas fa-link"></i></a>
</h2>
<p>Esta sección pretende ser una <strong>introducción a dicho entorno</strong>, y lo haremos principalmente con el conjunto de datos <code>starwars</code>, del paquete <a href="https://dplyr.tidyverse.org">dplyr</a> (ya cargado en <a href="https://tidyverse.tidyverse.org">tidyverse</a>).</p>
<p><a href="https://swapi.dev" target="_blank"><img src="img/starwars.jpg" width="70%" style="display: block; margin: auto;"></a></p>
<div class="sourceCode" id="cb1566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Dicho <strong>conjunto de datos</strong>, extraído de la <a href="https://swapi.dev">Star Wars API</a>, recopila diferentes datos y características de los personajes de la <mark><strong>saga Star Wars</strong></mark>. Como habrás advertido al escribir el conjunto en consola, <code>starwars</code> es una tabla en un formato ya conocido, un <code>tibble</code>, en el que se nos especifica al inicio de la tabla de qué tipo son cada columna:</p>
<ul>
<li>
<code>int</code>: números enteros.</li>
<li>
<code>dbl</code>: números reales (o racionales).</li>
<li>
<code>chr</code>: cadenas de texto.</li>
<li>
<code>lgl</code>: valores lógicos (<code>TRUE</code> o <code>FALSE</code>).</li>
<li>
<code>fct</code>: factores, variables cualitativas (categorías).</li>
<li>
<code>date</code>: fechas.</li>
<li>
<code>list</code>: listas.</li>
</ul>
<p>Nuestro conjunto de datos tiene <mark><strong>87 registros y 14 variables</strong></mark>.</p>
<div class="sourceCode" id="cb1568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Tipo de datos</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "tbl_df"     "tbl"        "data.frame"</code></pre>
<div class="sourceCode" id="cb1570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Dimensión de los datos</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 87 14</code></pre>
<p>Las <strong>funciones</strong> que veremos a lo largo de esta sección <mark><strong>siempre van a compartir una misma metodología</strong></mark>: primero escribimos el nombre un conjunto de datos <code>tibble</code> y después <strong>lo que queremos hacer</strong> a dicho conjunto de datos (con las variables SIN comillas) <mark><strong>encandenando órdenes con <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code></strong></mark>, de forma que <strong>obtendremos una nueva tabla</strong> en el mismo formato de entrada.</p>
<p>Con <code><a href="https://rdrr.io/pkg/pillar/man/glimpse.html">glimpse(starwars)</a></code> podemos obtener una <mark><strong>visión global de las variables</strong></mark> que tenemos en nuestros datos.</p>
<div class="sourceCode" id="cb1572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Resumen por columnas</span>
<span class="fu"><a href="https://rdrr.io/pkg/pillar/man/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 87
## Columns: 14
## $ name       &lt;chr&gt; "Luke Skywalker", "C-3PO", "R2-D2", "Darth Vader", "Leia Or…
## $ height     &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188, 180, 2…
## $ mass       &lt;dbl&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 84.0, 77.…
## $ hair_color &lt;chr&gt; "blond", NA, NA, "none", "brown", "brown, grey", "brown", N…
## $ skin_color &lt;chr&gt; "fair", "gold", "white, blue", "white", "light", "light", "…
## $ eye_color  &lt;chr&gt; "blue", "yellow", "red", "yellow", "brown", "blue", "blue",…
## $ birth_year &lt;dbl&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, NA, 24.0, 57.0, …
## $ sex        &lt;chr&gt; "male", "none", "none", "male", "female", "male", "female",…
## $ gender     &lt;chr&gt; "masculine", "masculine", "masculine", "masculine", "femini…
## $ homeworld  &lt;chr&gt; "Tatooine", "Tatooine", "Naboo", "Tatooine", "Alderaan", "T…
## $ species    &lt;chr&gt; "Human", "Droid", "Droid", "Human", "Human", "Human", "Huma…
## $ films      &lt;list&gt; &lt;"The Empire Strikes Back", "Revenge of the Sith", "Return…
## $ vehicles   &lt;list&gt; &lt;"Snowspeeder", "Imperial Speeder Bike"&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, "Imp…
## $ starships  &lt;list&gt; &lt;"X-wing", "Imperial shuttle"&gt;, &lt;&gt;, &lt;&gt;, "TIE Advanced x1",…</code></pre>
<p>Los <mark><strong>datos también podemos verlos</strong></mark> escribiendo el nombre de la tabla en la consola (recuerda que si es un <code>tibble</code>, para evitar saturar la consola, te saca un extracto, no todas las columnas y filas) o bien con la <strong>función <code><a href="https://rdrr.io/r/base/print.html">print()</a></code></strong>, indicándole <strong>número de filas</strong> (<code>n = 15</code> por ejemplo) y <strong>número de columnas</strong> (<code>width = Inf</code> si queremos mostrar todas).</p>
<div class="sourceCode" id="cb1574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Imprimir personalizado</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span>, n <span class="op">=</span> <span class="fl">5</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##   name           height  mass hair_color skin_color  eye_color birth_year sex   
##   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 Luke Skywalker    172    77 blond      fair        blue            19   male  
## 2 C-3PO             167    75 &lt;NA&gt;       gold        yellow         112   none  
## 3 R2-D2              96    32 &lt;NA&gt;       white, blue red             33   none  
## 4 Darth Vader       202   136 none       white       yellow          41.9 male  
## 5 Leia Organa       150    49 brown      light       brown           19   female
##   gender    homeworld species films     vehicles  starships
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
## 1 masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
## 2 masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
## 3 masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
## 4 masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 5 feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
## # … with 82 more rows</code></pre>
<p>Fíjate que las <strong>3 últimas variables</strong> son de <mark><strong>tipo lista</strong></mark> (echa un vistazo a <a href="ejercicios-recopilados.html#listas">Listas</a>). Por ejemplo, en <code>starwars$films</code> se <strong>guardan para cada personaje la colección de películas de la saga</strong> en las que aparece (algunos tendrán 1 solo nombre, otros 7). Por ejemplo, para extraer las películas en las que aparecen los tres primeros personajes, basta con ejecutar <code>starwars$films[1:3]</code> (del conjunto <code>starwars</code> –&gt; accedemos a la variable <code>films</code> con <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code>)</p>
<div class="sourceCode" id="cb1576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Las películas de los tres primeros personajes</span>
<span class="va">starwars</span><span class="op">$</span><span class="va">films</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]
## [1] "The Empire Strikes Back" "Revenge of the Sith"    
## [3] "Return of the Jedi"      "A New Hope"             
## [5] "The Force Awakens"      
## 
## [[2]]
## [1] "The Empire Strikes Back" "Attack of the Clones"   
## [3] "The Phantom Menace"      "Revenge of the Sith"    
## [5] "Return of the Jedi"      "A New Hope"             
## 
## [[3]]
## [1] "The Empire Strikes Back" "Attack of the Clones"   
## [3] "The Phantom Menace"      "Revenge of the Sith"    
## [5] "Return of the Jedi"      "A New Hope"             
## [7] "The Force Awakens"</code></pre>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dplyr"></span>
<img src="img/dplyr.png" alt="Cheet sheet de las opciones del paquete dplyr para la manipulación de datos extraída de &lt;https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf&gt;" width="90%"><p class="caption">
Imagen/gráfica 19.2: Cheet sheet de las opciones del paquete dplyr para la manipulación de datos extraída de <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf</a>
</p>
</div>
</div>
<div id="operaciones-con-filas" class="section level2">
<h2>
<span class="header-section-number">19.2</span> Operaciones con filas<a class="anchor" aria-label="anchor" href="#operaciones-con-filas"><i class="fas fa-link"></i></a>
</h2>
<p>Las <mark><strong>operaciones con filas</strong></mark> que podemos hacer son principalmente:</p>
<ul>
<li>
<strong>Seleccionar</strong> filas</li>
<li>
<strong>Reordenar</strong> filas</li>
<li>
<strong>Eliminar</strong> filas</li>
<li>Tratar filas <strong>duplicadas</strong>
</li>
<li>
<strong>Añadir</strong> registros nuevos</li>
</ul>
<div id="seleccionar-filas-filter-y-slice" class="section level3">
<h3>
<span class="header-section-number">19.2.1</span> Seleccionar filas (filter y slice)<a class="anchor" aria-label="anchor" href="#seleccionar-filas-filter-y-slice"><i class="fas fa-link"></i></a>
</h3>
<p>Empecemos por aprender a <mark><strong>seleccionar filas</strong></mark>. Principalmente tenemos <strong>tres opciones</strong>:</p>
<ol style="list-style-type: decimal">
<li>Seleccionarlas en base a algún <mark><strong>filtro o condición</strong></mark> (solo los mayores de tal edad, por ejemplo).</li>
<li>Extraer filas por su <mark><strong>índice de fila</strong></mark> (la fila que ocupa tal personaje).</li>
<li>Extraer filas <mark><strong>aleatoriamente (uniforme)</strong></mark> (por ejemplo, para un sorteo).</li>
</ol>
<p> </p>
<p>En el primer caso, la función <code><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter()</a></code> nos permite <mark><strong>seleccionar filas</strong></mark> en base al cumplimiento de una o varias <mark><strong>condiciones lógicas</strong></mark> respecto a las variables. Para usarla basta con que introduzcamos como argumento el conjunto de condiciones que debe cumplir (recuerda: el nombre de columnas sin comillas). Supongamos que queremos por ejemplo <mark><strong>seleccionar los personajes con ojos marrones</strong></mark>: nos bastará con usar <code><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter()</a></code> con la condición <code>eye_color == "brown"</code>.</p>
<div class="sourceCode" id="cb1578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">==</span> <span class="st">"brown"</span><span class="op">)</span> <span class="co"># con ojos marrones</span></code></pre></div>
<pre><code>## # A tibble: 21 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Leia Or…    150  49   brown      light      brown           19   fema… femin…
##  2 Biggs D…    183  84   black      light      brown           24   male  mascu…
##  3 Han Solo    180  80   brown      fair       brown           29   male  mascu…
##  4 Yoda         66  17   white      green      brown          896   male  mascu…
##  5 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
##  6 Lando C…    177  79   black      dark       brown           31   male  mascu…
##  7 Arvel C…     NA  NA   brown      fair       brown           NA   male  mascu…
##  8 Wicket …     88  20   brown      brown      brown            8   male  mascu…
##  9 Quarsh …    183  NA   black      dark       brown           62   &lt;NA&gt;  &lt;NA&gt;  
## 10 Shmi Sk…    163  NA   black      fair       brown           72   fema… femin…
## # … with 11 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Esta forma de trabajar los datos sería algo más difícil de leer fuera del entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a> (a pesar de que la operación es sencilla).</p>
<div class="sourceCode" id="cb1580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A la «antigua» usanza</span>
<span class="va">starwars</span><span class="op">[</span><span class="va">starwars</span><span class="op">$</span><span class="va">eye_color</span> <span class="op">==</span> <span class="st">"brown"</span>, <span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 21 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Leia Or…    150  49   brown      light      brown           19   fema… femin…
##  2 Biggs D…    183  84   black      light      brown           24   male  mascu…
##  3 Han Solo    180  80   brown      fair       brown           29   male  mascu…
##  4 Yoda         66  17   white      green      brown          896   male  mascu…
##  5 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
##  6 Lando C…    177  79   black      dark       brown           31   male  mascu…
##  7 Arvel C…     NA  NA   brown      fair       brown           NA   male  mascu…
##  8 Wicket …     88  20   brown      brown      brown            8   male  mascu…
##  9 Quarsh …    183  NA   black      dark       brown           62   &lt;NA&gt;  &lt;NA&gt;  
## 10 Shmi Sk…    163  NA   black      fair       brown           72   fema… femin…
## # … with 11 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Con <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code> y <code><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter()</a></code>, en tan solo una línea, hemos hecho más de lo que parece: <code>R</code> ha «recorrido» (algo similar a un bucle) cada una de las filas y ha ido comprobando que filas cumplen la condición y cuales no.</p>
<p>Con la misma lógica podemos <mark><strong>seleccionar los que NO TIENEN ojos marrones</strong></mark>, cambiando <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> por <code><a href="https://rdrr.io/r/base/Comparison.html">!=</a></code></p>
<div class="sourceCode" id="cb1582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">!=</span> <span class="st">"brown"</span><span class="op">)</span> <span class="co"># NO tengan ojos marrones</span></code></pre></div>
<pre><code>## # A tibble: 66 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  6 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  7 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  8 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
##  9 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
## 10 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
## # … with 56 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>También se pueden <mark><strong>seleccionar</strong></mark> los personajes que tienen los <mark><strong>ojos de una serie de colores permitidos</strong>: con <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code> le indicaremos que seleccione solo aquellas filas cuyo valor de la variable <code>eye_color</code> esté dentro de unos valores candidatos.</mark></p>
<div class="sourceCode" id="cb1584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># con ojos marrones, azules o rojos</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 45 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  3 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  4 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  5 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  6 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  7 Biggs …    183    84 black       light      brown           24   male  mascu…
##  8 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
##  9 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
## 10 Chewba…    228   112 brown       unknown    blue           200   male  mascu…
## # … with 35 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Si es una <strong>variable numérica</strong> también podemos <mark><strong>seleccionar por rango</strong></mark> con <code><a href="https://rdrr.io/pkg/dplyr/man/between.html">between()</a></code>, por ejemplo, los personajes cuya altura está entre 120 y 160 cm.</p>
<div class="sourceCode" id="cb1586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Con between filtramos por rango</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/between.html">between</a></span><span class="op">(</span><span class="va">height</span>, <span class="fl">120</span>, <span class="fl">160</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name     height  mass hair_color skin_color eye_color birth_year sex   gender 
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
## 1 Leia Or…    150    49 brown      light      brown             19 fema… femini…
## 2 Mon Mot…    150    NA auburn     fair       blue              48 fema… femini…
## 3 Nien Nu…    160    68 none       grey       black             NA male  mascul…
## 4 Watto       137    NA black      blue, grey yellow            NA male  mascul…
## 5 Gasgano     122    NA none       white, bl… black             NA male  mascul…
## 6 Cordé       157    NA brown      light      brown             NA fema… femini…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Las <strong>condiciones se pueden concatenar y complejizar</strong> todo lo que queramos, pudiendo en pocas líneas realizar un <mark><strong>filtro complejo</strong></mark>, por ejemplo, seleccionando los personajes con ojos marrones Y ADEMÁS que sean humanos.</p>
<div class="sourceCode" id="cb1588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># humanos con ojos marrones</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">==</span> <span class="st">"brown"</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 17 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Leia Or…    150  49   brown      light      brown           19   fema… femin…
##  2 Biggs D…    183  84   black      light      brown           24   male  mascu…
##  3 Han Solo    180  80   brown      fair       brown           29   male  mascu…
##  4 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
##  5 Lando C…    177  79   black      dark       brown           31   male  mascu…
##  6 Arvel C…     NA  NA   brown      fair       brown           NA   male  mascu…
##  7 Shmi Sk…    163  NA   black      fair       brown           72   fema… femin…
##  8 Mace Wi…    188  84   none       dark       brown           72   male  mascu…
##  9 Gregar …    185  85   black      dark       brown           NA   male  mascu…
## 10 Cordé       157  NA   brown      light      brown           NA   fema… femin…
## 11 Dormé       165  NA   brown      light      brown           NA   fema… femin…
## 12 Dooku       193  80   white      fair       brown          102   male  mascu…
## 13 Bail Pr…    191  NA   black      tan        brown           67   male  mascu…
## 14 Jango F…    183  79   black      tan        brown           66   male  mascu…
## 15 Raymus …    188  79   brown      light      brown           NA   male  mascu…
## 16 Poe Dam…     NA  NA   brown      light      brown           NA   male  mascu…
## 17 Padmé A…    165  45   brown      light      brown           46   fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Otro ejemplo: vamos a <strong>filtrar personajes</strong> con ojos marrones, azules o rojos, que no sean humanos, y con menos de 50 años.</p>
<div class="sourceCode" id="cb1590"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># humanos con ojos marrones, azules o rojos, que no sean humanos, y menos de 50a</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,
         <span class="va">species</span> <span class="op">!=</span> <span class="st">"Human"</span>, <span class="va">birth_year</span> <span class="op">&lt;</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2         96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
## 2 IG-88        200   140 none       metal      red               15 none  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 4 Barriss …    166    50 black      yellow     blue              40 fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p> </p>
<p>Si estamos en el segundo caso mencionado al inicio, querremos <mark><strong>extraer filas simplemente por el lugar que ocupan</strong></mark>, sin hacer que dependa de ninguna condición, por ejemplo, la <strong>primera fila</strong>. Para ello haremos uso de la función <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice()</a></code>.</p>
<div class="sourceCode" id="cb1592"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># slice: extramos filas por índice de fila.</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># primera fila</span></code></pre></div>
<pre><code>## # A tibble: 1 × 14
##   name     height  mass hair_color skin_color eye_color birth_year sex   gender 
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
## 1 Luke Sk…    172    77 blond      fair       blue              19 male  mascul…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Podemos extraer <strong>varias a la vez</strong>, por ejemplo, <strong>filtrando las filas</strong> quinta, sexta, séptima, octava, novena y décima.</p>
<div class="sourceCode" id="cb1594"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># slice: extramos filas por índice de fila.</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="co"># filas de la 5 a la 10</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Leia Or…    150    49 brown       light      brown             19 fema… femin…
## 2 Owen La…    178   120 brown, grey light      blue              52 male  mascu…
## 3 Beru Wh…    165    75 brown       light      blue              47 fema… femin…
## 4 R5-D4        97    32 &lt;NA&gt;        white, red red               NA none  mascu…
## 5 Biggs D…    183    84 black       light      brown             24 male  mascu…
## 6 Obi-Wan…    182    77 auburn, wh… fair       blue-gray         57 male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Como sucedía cuando trabajábamos con vectores, también podemos <strong>combinar los índices</strong> para extraer, por ejemplo solo las filas pares, o filas concretas separadas por los espacios que queramos.</p>
<div class="sourceCode" id="cb1596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># filas pares hasta la décima</span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 C-3PO       167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
## 2 Darth V…    202   136 none        white      yellow          41.9 male  mascu…
## 3 Owen La…    178   120 brown, grey light      blue            52   male  mascu…
## 4 R5-D4        97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
## 5 Obi-Wan…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1598"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">33</span><span class="op">)</span><span class="op">)</span> <span class="co"># filas 3, 4, 10, 20 y 33</span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2        96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
## 2 Darth V…    202   136 none        white      yellow          41.9 male  mascu…
## 3 Obi-Wan…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 4 Palpati…    170    75 grey        pale       yellow          82   male  mascu…
## 5 Finis V…    170    NA blond       fair       blue            91   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Disponemos además de <strong>opciones por defecto</strong> para directamente <mark><strong>extraer las primeras o últimas filas</strong></mark> con <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_head()</a></code> y <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_tail()</a></code>.</p>
<div class="sourceCode" id="cb1600"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos extraer directamente las primeras o últimas filas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># 5 primeras filas </span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name     height  mass hair_color skin_color  eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sk…    172    77 blond      fair        blue            19   male  mascu…
## 2 C-3PO       167    75 &lt;NA&gt;       gold        yellow         112   none  mascu…
## 3 R2-D2        96    32 &lt;NA&gt;       white, blue red             33   none  mascu…
## 4 Darth V…    202   136 none       white       yellow          41.9 male  mascu…
## 5 Leia Or…    150    49 brown      light       brown           19   fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1602"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># 2 últimas filas </span></code></pre></div>
<pre><code>## # A tibble: 2 × 14
##   name     height  mass hair_color skin_color eye_color birth_year sex    gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
## 1 Captain…     NA    NA unknown    unknown    unknown           NA &lt;NA&gt;   &lt;NA&gt;  
## 2 Padmé A…    165    45 brown      light      brown             46 female femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p> </p>
<p>La tercera opción habitual es querer <mark><strong>extraer un número de filas pero AL AZAR</strong></mark>, pudiendo hacerlo sin reemplazamiento (una vez extraída, no se puede volver a extraer) o con reemplazamiento (con <code>replace = TRUE</code>).</p>
<div class="sourceCode" id="cb1604"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># También podemos hacer una extracción al azar de filas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># 5 al azar</span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name     height  mass hair_color skin_color eye_color birth_year sex    gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
## 1 Darth M…    175    80 none       red        yellow            54 male   mascu…
## 2 Luke Sk…    172    77 blond      fair       blue              19 male   mascu…
## 3 Ayla Se…    178    55 none       blue       hazel             48 female femin…
## 4 Nien Nu…    160    68 none       grey       black             NA male   mascu…
## 5 Finn         NA    NA black      dark       dark              NA male   mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1606"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 100 con reemplazamiento</span>
<span class="co"># (si fuera sin reemplazamiento, daría error)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 100 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Jek Ton…    180   110 brown      fair       blue              NA male  mascu…
##  2 IG-88       200   140 none       metal      red               15 none  mascu…
##  3 Ayla Se…    178    55 none       blue       hazel             48 fema… femin…
##  4 Leia Or…    150    49 brown      light      brown             19 fema… femin…
##  5 Gregar …    185    85 black      dark       brown             NA male  mascu…
##  6 Palpati…    170    75 grey       pale       yellow            82 male  mascu…
##  7 Han Solo    180    80 brown      fair       brown             29 male  mascu…
##  8 Tarfful     234   136 brown      brown      blue              NA male  mascu…
##  9 Wicket …     88    20 brown      brown      brown              8 male  mascu…
## 10 Greedo      173    74 &lt;NA&gt;       green      black             44 male  mascu…
## # … with 90 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Por último, tenemos <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_min()</a></code> y <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_max()</a></code> que nos permite <mark><strong>extraer filas en función del mínimo y máximo de una variable</strong></mark>. Por defecto, si hay empate, mostrará todas las filas (aunque supere el número <code>n</code> indicado), salvo que <code>with_ties = FALSE</code>, que decidirá en caso de empate cual mostrarte. Por ejemplo, vamos a filtrar con <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_min(height, n = 5)</a></code> los 5 personasjes más bajitos, y con <code>starwars %&gt;% slice_max(mass, n = 7)</code> los 7 personajes más pesados.</p>
<div class="sourceCode" id="cb1608"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos extraer filas en función del mín/máx de una variable</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_min</a></span><span class="op">(</span><span class="va">height</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># los 5 más bajitos</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Yoda          66    17 white      green      brown            896 male  mascu…
## 2 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 4 Dud Bolt      94    45 none       blue, grey yellow            NA male  mascu…
## 5 R2-D2         96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
## 6 R4-P17        96    NA none       silver, r… red, blue         NA none  femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1610"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># los 5 más bajitos (sin empates, exactamente 5)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_min</a></span><span class="op">(</span><span class="va">height</span>, n <span class="op">=</span> <span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Yoda          66    17 white      green      brown            896 male  mascu…
## 2 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 4 Dud Bolt      94    45 none       blue, grey yellow            NA male  mascu…
## 5 R2-D2         96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1612"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_max</a></span><span class="op">(</span><span class="va">mass</span>, n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="co"># los 7 más pesados</span></code></pre></div>
<pre><code>## # A tibble: 7 × 14
##   name    height  mass hair_color  skin_color  eye_color birth_year sex   gender
##   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Jabba …    175  1358 &lt;NA&gt;        green-tan,… orange         600   herm… mascu…
## 2 Grievo…    216   159 none        brown, whi… green, y…       NA   male  mascu…
## 3 IG-88      200   140 none        metal       red             15   none  mascu…
## 4 Darth …    202   136 none        white       yellow          41.9 male  mascu…
## 5 Tarfful    234   136 brown       brown       blue            NA   male  mascu…
## 6 Owen L…    178   120 brown, grey light       blue            52   male  mascu…
## 7 Bossk      190   113 none        green       red             53   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div id="reordenar-filas-arrange" class="section level3">
<h3>
<span class="header-section-number">19.2.2</span> Reordenar filas (arrange)<a class="anchor" aria-label="anchor" href="#reordenar-filas-arrange"><i class="fas fa-link"></i></a>
</h3>
<p>Otra operación habitual en las filas es <mark><strong>ordenarlas en función del valor de alguna de las variables</strong></mark>. Para ello tenemos la función <code><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange()</a></code>, que usaremos pasándole como argumento el <strong>nombre de la variable</strong> que usaremos para la ordenación. Por ejemplo, vamos a <mark><strong>ordenar nuestra tabla de personajes por altura</strong></mark>, de bajitos a altos.</p>
<div class="sourceCode" id="cb1614"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Con arrange ordenamos en base al orden de la variable que introduzcamos</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span> <span class="co"># de bajitos a altos, yoda al poder</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda         66    17 white      green      brown            896 male  mascu…
##  2 Ratts T…     79    15 none       grey, blue unknown           NA male  mascu…
##  3 Wicket …     88    20 brown      brown      brown              8 male  mascu…
##  4 Dud Bolt     94    45 none       blue, grey yellow            NA male  mascu…
##  5 R2-D2        96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
##  6 R4-P17       96    NA none       silver, r… red, blue         NA none  femin…
##  7 R5-D4        97    32 &lt;NA&gt;       white, red red               NA none  mascu…
##  8 Sebulba     112    40 none       grey, red  orange            NA male  mascu…
##  9 Gasgano     122    NA none       white, bl… black             NA male  mascu…
## 10 Watto       137    NA black      blue, grey yellow            NA male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Por defecto la <mark><strong>ordenación es de menor a mayor</strong></mark> pero <strong>podemos invertirlo</strong> usando <code><a href="https://rdrr.io/pkg/dplyr/man/desc.html">desc()</a></code>.</p>
<div class="sourceCode" id="cb1616"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Por defecto lo hace ascendente pero podemos cambiarlo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/desc.html">desc</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color skin_color  eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yarael…    264    NA none       white       yellow          NA   male  mascu…
##  2 Tarfful    234   136 brown      brown       blue            NA   male  mascu…
##  3 Lama Su    229    88 none       grey        black           NA   male  mascu…
##  4 Chewba…    228   112 brown      unknown     blue           200   male  mascu…
##  5 Roos T…    224    82 none       grey        orange          NA   male  mascu…
##  6 Grievo…    216   159 none       brown, whi… green, y…       NA   male  mascu…
##  7 Taun We    213    NA none       grey        black           NA   fema… femin…
##  8 Rugor …    206    NA none       green       orange          NA   male  mascu…
##  9 Tion M…    206    80 none       grey        black           NA   male  mascu…
## 10 Darth …    202   136 none       white       yellow          41.9 male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>La ordenación también puede realizarse <strong>en base al valor de dos o más variables</strong>: ordenará las filas en base a la primera, en caso de empate usará la segunda, en caso de empate la tercera, y así sucesivamente. Vamos a ordenar los <strong>personajes por altura y, luego, por peso</strong>.</p>
<div class="sourceCode" id="cb1618"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos combinar varios criterios: ordenados de bajitos a altos,</span>
<span class="co"># y en caso de empate, de pesados a ligeros. Un dato NA va siempre al final</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange</a></span><span class="op">(</span><span class="va">height</span>, <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/desc.html">desc</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda         66    17 white      green      brown            896 male  mascu…
##  2 Ratts T…     79    15 none       grey, blue unknown           NA male  mascu…
##  3 Wicket …     88    20 brown      brown      brown              8 male  mascu…
##  4 Dud Bolt     94    45 none       blue, grey yellow            NA male  mascu…
##  5 R2-D2        96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
##  6 R4-P17       96    NA none       silver, r… red, blue         NA none  femin…
##  7 R5-D4        97    32 &lt;NA&gt;       white, red red               NA none  mascu…
##  8 Sebulba     112    40 none       grey, red  orange            NA male  mascu…
##  9 Gasgano     122    NA none       white, bl… black             NA male  mascu…
## 10 Watto       137    NA black      blue, grey yellow            NA male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p> </p>
<p><strong><span style="color: #ffc107;">WARNING: valores ausentes</span></strong></p>
<p>Si te fijas los <strong><span style="color: #ffc107;">valores ausentes van siempre al final</span></strong> de la ordenación. Luego veremos como eliminarlos si quisiéramos.</p>
<p> </p>
<p>Como estarás imaginando <strong>podemos combinar varias acciones en pocas líneas</strong>, <mark><strong>filtrando a la vez que ordenamos</strong></mark> el filtro resultante. Como ejemplo vamos a seleccionar solo los personajes que sean humanos, hombres y de ojos marrones, para después ordernarlos en altura descendente y peso ascendente.</p>
<div class="sourceCode" id="cb1620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos combinar varias acciones en pocas líneas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">==</span> <span class="st">"brown"</span>,
         <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange</a></span><span class="op">(</span><span class="va">height</span>, <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/desc.html">desc</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Lando C…    177  79   black      dark       brown           31   male  mascu…
##  2 Han Solo    180  80   brown      fair       brown           29   male  mascu…
##  3 Biggs D…    183  84   black      light      brown           24   male  mascu…
##  4 Jango F…    183  79   black      tan        brown           66   male  mascu…
##  5 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
##  6 Gregar …    185  85   black      dark       brown           NA   male  mascu…
##  7 Mace Wi…    188  84   none       dark       brown           72   male  mascu…
##  8 Raymus …    188  79   brown      light      brown           NA   male  mascu…
##  9 Bail Pr…    191  NA   black      tan        brown           67   male  mascu…
## 10 Dooku       193  80   white      fair       brown          102   male  mascu…
## 11 Arvel C…     NA  NA   brown      fair       brown           NA   male  mascu…
## 12 Poe Dam…     NA  NA   brown      light      brown           NA   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div id="eliminar-filas-y-duplicados-slice-y-distinct" class="section level3">
<h3>
<span class="header-section-number">19.2.3</span> Eliminar filas y duplicados (slice y distinct)<a class="anchor" aria-label="anchor" href="#eliminar-filas-y-duplicados-slice-y-distinct"><i class="fas fa-link"></i></a>
</h3>
<p>La misma lógica que hemos usado para seleccionar filas podemos usarla para <mark><strong>eliminar filas</strong></mark> con <code><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice()</a></code>, simplemente negando la condición de filtrado. Por ejemplo, vamos a <strong>eliminar las 5 primeras filas</strong>.</p>
<div class="sourceCode" id="cb1622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos por índices</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># eliminamos las 5 primeras filas</span></code></pre></div>
<pre><code>## # A tibble: 82 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  2 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  3 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  4 Biggs …    183    84 black       light      brown           24   male  mascu…
##  5 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
##  6 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
##  7 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
##  8 Chewba…    228   112 brown       unknown    blue           200   male  mascu…
##  9 Han So…    180    80 brown       fair       brown           29   male  mascu…
## 10 Greedo     173    74 &lt;NA&gt;        green      black           44   male  mascu…
## # … with 72 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Otra opción a la hora de eliminar filas es <mark><strong>eliminar las filas duplicadas</strong></mark> (o filas con valores duplicados en alguna columna). Para ello deberemos aplicar la función <code><a href="https://rdrr.io/pkg/dplyr/man/distinct.html">distinct()</a></code>, pasándole como argumentos el nombre de las variables que usaremos para quitar duplicados, por ejemplo, aquellos personajes con igual par de color de pelo y ojos.</p>
<div class="sourceCode" id="cb1624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos duplicados</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># Eliminamos registros con igual par (color_pelo, color_ojos)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/distinct.html">distinct</a></span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">eye_color</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 35 × 2
##    hair_color    eye_color
##    &lt;chr&gt;         &lt;chr&gt;    
##  1 blond         blue     
##  2 &lt;NA&gt;          yellow   
##  3 &lt;NA&gt;          red      
##  4 none          yellow   
##  5 brown         brown    
##  6 brown, grey   blue     
##  7 brown         blue     
##  8 black         brown    
##  9 auburn, white blue-gray
## 10 auburn, grey  blue     
## # … with 25 more rows</code></pre>
<p>Si te fijas además nos ha extraído solo las dos columnas en base a las cuales hemos eliminado duplicados. Si queremos que <strong>nos mantenga toda la tabla</strong> deberemos explicitarlo con <code>.keep_all = TRUE</code>.</p>
<div class="sourceCode" id="cb1626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos duplicados</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># Eliminamos registros con igual par (color_pelo, color_ojos)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/distinct.html">distinct</a></span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">eye_color</span>,
           .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># .keep_all = TRUE mantiene todas columnas</span></code></pre></div>
<pre><code>## # A tibble: 35 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 Biggs …    183    84 black       light      brown           24   male  mascu…
##  9 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 10 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
## # … with 25 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Si no incluimos <strong>ningún nombre</strong> de columna <strong>nos eliminará solo los registros que tengan TODOS los campos duplicados</strong>.</p>
<div class="sourceCode" id="cb1628"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Duplicamos el conjunto para probarlo</span>
<span class="va">duplicado_starwars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">starwars</span>, <span class="va">starwars</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">duplicado_starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 174  14</code></pre>
<div class="sourceCode" id="cb1630"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos duplicados (filas exactamente iguales)</span>
<span class="va">duplicado_starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">duplicado_starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 87 14</code></pre>
</div>
<div id="añadir-filas-bind_rows" class="section level3">
<h3>
<span class="header-section-number">19.2.4</span> Añadir filas (bind_rows)<a class="anchor" aria-label="anchor" href="#a%C3%B1adir-filas-bind_rows"><i class="fas fa-link"></i></a>
</h3>
<p>No suele ser habitual ya que normalmente los datos los tendremos cargados, y nuestro objetivo será depurar (que implicará tener las mismas o menos filas). Pero si quisiéramos <mark><strong>añadir un nuevo registro manualmente</strong></mark>, podremos hacerlo con <code><a href="https://rdrr.io/pkg/dplyr/man/bind.html">bind_rows()</a></code>, <strong>asegurándonos</strong> que las variables en el nuevo registro son las mismas que en el original. Vamos a añadir al fichero original los 3 primeros registros (al final).</p>
<div class="sourceCode" id="cb1634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars_nuevo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">starwars</span>, <span class="va">starwars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 87 14</code></pre>
<div class="sourceCode" id="cb1636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">starwars_nuevo</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 90 14</code></pre>
<div class="sourceCode" id="cb1638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars_nuevo</span></code></pre></div>
<pre><code>## # A tibble: 90 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 80 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<div id="operaciones-con-columnas" class="section level2">
<h2>
<span class="header-section-number">19.3</span> Operaciones con columnas<a class="anchor" aria-label="anchor" href="#operaciones-con-columnas"><i class="fas fa-link"></i></a>
</h2>
<p>Ya hemos visto algunas opciones para manejar filas. Pasemos a <mark><strong>manipular columnas</strong></mark>.</p>
<div id="seleccionar-columnas-select" class="section level3">
<h3>
<span class="header-section-number">19.3.1</span> Seleccionar columnas (select)<a class="anchor" aria-label="anchor" href="#seleccionar-columnas-select"><i class="fas fa-link"></i></a>
</h3>
<p>La opción más sencilla para <mark><strong>seleccionar variables/columnas</strong></mark> es usar la función <code><a href="https://rdrr.io/pkg/dplyr/man/select.html">select()</a></code>, pasándole como argumentos los <strong>nombres de columnas</strong> (¡SIN COMILLAS!) qque ueremos seleccionar, por ejemplo, color de pelo.</p>
<div class="sourceCode" id="cb1640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select: columnas a seleccionar sin comillas</span>
<span class="co"># seleccionamos solo 1 columna: color de pelo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">hair_color</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    hair_color   
##    &lt;chr&gt;        
##  1 blond        
##  2 &lt;NA&gt;         
##  3 &lt;NA&gt;         
##  4 none         
##  5 brown        
##  6 brown, grey  
##  7 brown        
##  8 &lt;NA&gt;         
##  9 black        
## 10 auburn, white
## # … with 77 more rows</code></pre>
<p>Podemos <mark><strong>seleccionar varias a la vez</strong></mark> concatenando sus nombres, por ejemplo, sellecionando las variables de color de pelo, piel y ojos.</p>
<div class="sourceCode" id="cb1642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># seleccionamos solo 3 columnas: pelo, piel y ojos</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">skin_color</span>, <span class="va">eye_color</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<p>Si las columnas a seleccionar son <mark><strong>consecutivas</strong></mark>, podemos indicarle que las seleccionemos desde una <strong>columna inicial hasta una columna inicial</strong> pasando por todas con <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code>.</p>
<div class="sourceCode" id="cb1644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># desde nombre hasta año nacim.</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">:</span><span class="va">birth_year</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 7
##    name               height  mass hair_color    skin_color eye_color birth_year
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke Skywalker        172    77 blond         fair       blue            19  
##  2 C-3PO                 167    75 &lt;NA&gt;          gold       yellow         112  
##  3 R2-D2                  96    32 &lt;NA&gt;          white, bl… red             33  
##  4 Darth Vader           202   136 none          white      yellow          41.9
##  5 Leia Organa           150    49 brown         light      brown           19  
##  6 Owen Lars             178   120 brown, grey   light      blue            52  
##  7 Beru Whitesun lars    165    75 brown         light      blue            47  
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red red             NA  
##  9 Biggs Darklighter     183    84 black         light      brown           24  
## 10 Obi-Wan Kenobi        182    77 auburn, white fair       blue-gray       57  
## # … with 77 more rows</code></pre>
<p>Las columnas también las podemos seleccionar a través de expresiones regulares, por ejemplo, <mark><strong>seleccionando solo aquellas columnas que compartan un sufijo común en el nombre</strong></mark>, con <code><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">ends_with()</a></code> dentro de órdenes como <code><a href="https://rdrr.io/pkg/dplyr/man/select.html">select()</a></code></p>
<div class="sourceCode" id="cb1646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos seleccionar columnas por sufijo y prefijo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span><span class="op">)</span> <span class="co"># acaban en "color"</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<p>De una manera similar podemos <mark><strong>seleccionar columnas cuyo nombre empiecen o contengan</strong></mark> alguna cadena de texto concreta, con <code><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">starts_with()</a></code> o <code><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">contains()</a></code>.</p>
<div class="sourceCode" id="cb1648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"h"</span><span class="op">)</span><span class="op">)</span> <span class="co"># empiezan por h</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    height hair_color    homeworld
##     &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;    
##  1    172 blond         Tatooine 
##  2    167 &lt;NA&gt;          Tatooine 
##  3     96 &lt;NA&gt;          Naboo    
##  4    202 none          Tatooine 
##  5    150 brown         Alderaan 
##  6    178 brown, grey   Tatooine 
##  7    165 brown         Tatooine 
##  8     97 &lt;NA&gt;          Tatooine 
##  9    183 black         Tatooine 
## 10    182 auburn, white Stewjon  
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb1650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"h"</span><span class="op">)</span><span class="op">)</span> <span class="co"># contienen la h</span></code></pre></div>
<pre><code>## # A tibble: 87 × 6
##    height hair_color    birth_year homeworld vehicles  starships
##     &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;     &lt;list&gt;    &lt;list&gt;   
##  1    172 blond               19   Tatooine  &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2    167 &lt;NA&gt;               112   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3     96 &lt;NA&gt;                33   Naboo     &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4    202 none                41.9 Tatooine  &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5    150 brown               19   Alderaan  &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6    178 brown, grey         52   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7    165 brown               47   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8     97 &lt;NA&gt;                NA   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9    183 black               24   Tatooine  &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10    182 auburn, white       57   Stewjon   &lt;chr [1]&gt; &lt;chr [5]&gt;
## # … with 77 more rows</code></pre>
<p>Todo lo que hemos usado para seleccionar lo podemos usar para <mark><strong>eliminar columnas</strong></mark></p>
<div class="sourceCode" id="cb1652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># seleccionamos todas menos 3 columnas: pelo, piel y ojos</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">skin_color</span>, <span class="va">eye_color</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 11
##    name    height  mass birth_year sex   gender homeworld species films vehicles
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;lis&gt; &lt;list&gt;  
##  1 Luke S…    172    77       19   male  mascu… Tatooine  Human   &lt;chr… &lt;chr [2…
##  2 C-3PO      167    75      112   none  mascu… Tatooine  Droid   &lt;chr… &lt;chr [0…
##  3 R2-D2       96    32       33   none  mascu… Naboo     Droid   &lt;chr… &lt;chr [0…
##  4 Darth …    202   136       41.9 male  mascu… Tatooine  Human   &lt;chr… &lt;chr [0…
##  5 Leia O…    150    49       19   fema… femin… Alderaan  Human   &lt;chr… &lt;chr [1…
##  6 Owen L…    178   120       52   male  mascu… Tatooine  Human   &lt;chr… &lt;chr [0…
##  7 Beru W…    165    75       47   fema… femin… Tatooine  Human   &lt;chr… &lt;chr [0…
##  8 R5-D4       97    32       NA   none  mascu… Tatooine  Droid   &lt;chr… &lt;chr [0…
##  9 Biggs …    183    84       24   male  mascu… Tatooine  Human   &lt;chr… &lt;chr [0…
## 10 Obi-Wa…    182    77       57   male  mascu… Stewjon   Human   &lt;chr… &lt;chr [1…
## # … with 77 more rows, and 1 more variable: starships &lt;list&gt;</code></pre>
<p>Incluso nos permite <mark><strong>seleccionar aquellas columnas que son del mismo tipo</strong></mark> (imagina que necesitamos solo las columnas numéricas para calcular ciertas estadísticas) con <code>where()</code>.</p>
<div class="sourceCode" id="cb1654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Seleccionamos solo la columnas numéricas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    height  mass birth_year
##     &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77       19  
##  2    167    75      112  
##  3     96    32       33  
##  4    202   136       41.9
##  5    150    49       19  
##  6    178   120       52  
##  7    165    75       47  
##  8     97    32       NA  
##  9    183    84       24  
## 10    182    77       57  
## # … with 77 more rows</code></pre>
</div>
<div id="extraer-columnas-pull" class="section level3">
<h3>
<span class="header-section-number">19.3.2</span> Extraer columnas (pull)<a class="anchor" aria-label="anchor" href="#extraer-columnas-pull"><i class="fas fa-link"></i></a>
</h3>
<p>También podemos no tanto seleccionar sino <mark><strong>extraer columnas</strong></mark>: las saca fuera de la tabla y las convierte en un vector fuera del <code>tibble</code>, con la función <code><a href="https://rdrr.io/pkg/dplyr/man/pull.html">pull()</a></code>.</p>
<div class="sourceCode" id="cb1656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    name              
##    &lt;chr&gt;             
##  1 Luke Skywalker    
##  2 C-3PO             
##  3 R2-D2             
##  4 Darth Vader       
##  5 Leia Organa       
##  6 Owen Lars         
##  7 Beru Whitesun lars
##  8 R5-D4             
##  9 Biggs Darklighter 
## 10 Obi-Wan Kenobi    
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb1658"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/pull.html">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "Luke Skywalker"        "C-3PO"                 "R2-D2"                
##  [4] "Darth Vader"           "Leia Organa"           "Owen Lars"            
##  [7] "Beru Whitesun lars"    "R5-D4"                 "Biggs Darklighter"    
## [10] "Obi-Wan Kenobi"        "Anakin Skywalker"      "Wilhuff Tarkin"       
## [13] "Chewbacca"             "Han Solo"              "Greedo"               
## [16] "Jabba Desilijic Tiure" "Wedge Antilles"        "Jek Tono Porkins"     
## [19] "Yoda"                  "Palpatine"             "Boba Fett"            
## [22] "IG-88"                 "Bossk"                 "Lando Calrissian"     
## [25] "Lobot"                 "Ackbar"                "Mon Mothma"           
## [28] "Arvel Crynyd"          "Wicket Systri Warrick" "Nien Nunb"            
## [31] "Qui-Gon Jinn"          "Nute Gunray"           "Finis Valorum"        
## [34] "Jar Jar Binks"         "Roos Tarpals"          "Rugor Nass"           
## [37] "Ric Olié"              "Watto"                 "Sebulba"              
## [40] "Quarsh Panaka"         "Shmi Skywalker"        "Darth Maul"           
## [43] "Bib Fortuna"           "Ayla Secura"           "Dud Bolt"             
## [46] "Gasgano"               "Ben Quadinaros"        "Mace Windu"           
## [49] "Ki-Adi-Mundi"          "Kit Fisto"             "Eeth Koth"            
## [52] "Adi Gallia"            "Saesee Tiin"           "Yarael Poof"          
## [55] "Plo Koon"              "Mas Amedda"            "Gregar Typho"         
## [58] "Cordé"                 "Cliegg Lars"           "Poggle the Lesser"    
## [61] "Luminara Unduli"       "Barriss Offee"         "Dormé"                
## [64] "Dooku"                 "Bail Prestor Organa"   "Jango Fett"           
## [67] "Zam Wesell"            "Dexter Jettster"       "Lama Su"              
## [70] "Taun We"               "Jocasta Nu"            "Ratts Tyerell"        
## [73] "R4-P17"                "Wat Tambor"            "San Hill"             
## [76] "Shaak Ti"              "Grievous"              "Tarfful"              
## [79] "Raymus Antilles"       "Sly Moore"             "Tion Medon"           
## [82] "Finn"                  "Rey"                   "Poe Dameron"          
## [85] "BB8"                   "Captain Phasma"        "Padmé Amidala"</code></pre>
<p>Esta opción es útil cuando los valores de una variable lo vamos a sacar del flujo de datos, para ser usada en otros procesos (como predicción).</p>
</div>
<div id="renombrar-rename-y-reordenar-relocate-columnas" class="section level3">
<h3>
<span class="header-section-number">19.3.3</span> Renombrar (rename) y reordenar (relocate) columnas<a class="anchor" aria-label="anchor" href="#renombrar-rename-y-reordenar-relocate-columnas"><i class="fas fa-link"></i></a>
</h3>
<p>A veces también podemos querer <strong>modificar la «metainformación» de la tabla</strong>, no modificando los datos sino <mark><strong>renombrando el orden de las columnas</strong></mark>. Para ello debremos usar la función <code><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename()</a></code> poniendo primero el nombre nuevo y luego el antiguo. Como ejemplo, vamos a traducir el nombre de las columnas <code>name, height, mass</code> a castellano.</p>
<div class="sourceCode" id="cb1660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># rename: renombrar columnas, primero el nuevo y luego el antiguo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename</a></span><span class="op">(</span>nombre <span class="op">=</span> <span class="va">name</span>, altura <span class="op">=</span> <span class="va">height</span>, peso <span class="op">=</span> <span class="va">mass</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    nombre   altura  peso hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
##  3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
##  4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
##  5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
##  6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
##  7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
##  9 Biggs D…    183    84 black      light      brown           24   male  mascu…
## 10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>De la misma manera podemos <mark><strong>reordenar las columnas</strong></mark>, indicando el nombre de columnas que queremos mover, y con <code>.after</code> y/o <code>.before</code> para indicar antes o después de que columnas queremos moverlas.</p>
<div class="sourceCode" id="cb1662"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># altura y masa detrás de color de piel</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/relocate.html">relocate</a></span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, .after <span class="op">=</span> <span class="va">skin_color</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    hair_color  skin_color height  mass eye_color birth_year sex   gender
##    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S… blond       fair          172    77 blue            19   male  mascu…
##  2 C-3PO   &lt;NA&gt;        gold          167    75 yellow         112   none  mascu…
##  3 R2-D2   &lt;NA&gt;        white, bl…     96    32 red             33   none  mascu…
##  4 Darth … none        white         202   136 yellow          41.9 male  mascu…
##  5 Leia O… brown       light         150    49 brown           19   fema… femin…
##  6 Owen L… brown, grey light         178   120 blue            52   male  mascu…
##  7 Beru W… brown       light         165    75 blue            47   fema… femin…
##  8 R5-D4   &lt;NA&gt;        white, red     97    32 red             NA   none  mascu…
##  9 Biggs … black       light         183    84 brown           24   male  mascu…
## 10 Obi-Wa… auburn, wh… fair          182    77 blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1664"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># color de piel, pelo y ojos antes de peso</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/relocate.html">relocate</a></span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">skin_color</span>, <span class="va">eye_color</span>,
           .before <span class="op">=</span> <span class="va">mass</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height hair_color  skin_color eye_color  mass birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172 blond       fair       blue         77       19   male  mascu…
##  2 C-3PO      167 &lt;NA&gt;        gold       yellow       75      112   none  mascu…
##  3 R2-D2       96 &lt;NA&gt;        white, bl… red          32       33   none  mascu…
##  4 Darth …    202 none        white      yellow      136       41.9 male  mascu…
##  5 Leia O…    150 brown       light      brown        49       19   fema… femin…
##  6 Owen L…    178 brown, grey light      blue        120       52   male  mascu…
##  7 Beru W…    165 brown       light      blue         75       47   fema… femin…
##  8 R5-D4       97 &lt;NA&gt;        white, red red          32       NA   none  mascu…
##  9 Biggs …    183 black       light      brown        84       24   male  mascu…
## 10 Obi-Wa…    182 auburn, wh… fair       blue-gray    77       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Otra opción es hacerlo con <code><a href="https://rdrr.io/pkg/dplyr/man/select.html">select()</a></code>, indicándole el orden de las columnas manualmente, pudiendo hacer uso de <code><a href="https://rdrr.io/pkg/tidyselect/man/everything.html">everything()</a></code> para <strong>incluir el resto de columnas no mencionadas anteriormente</strong>.</p>
<div class="sourceCode" id="cb1666"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">homeworld</span>, <span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name  homeworld height  mass hair_color skin_color eye_color birth_year sex  
##    &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
##  1 Luke… Tatooine     172    77 blond      fair       blue            19   male 
##  2 C-3PO Tatooine     167    75 &lt;NA&gt;       gold       yellow         112   none 
##  3 R2-D2 Naboo         96    32 &lt;NA&gt;       white, bl… red             33   none 
##  4 Dart… Tatooine     202   136 none       white      yellow          41.9 male 
##  5 Leia… Alderaan     150    49 brown      light      brown           19   fema…
##  6 Owen… Tatooine     178   120 brown, gr… light      blue            52   male 
##  7 Beru… Tatooine     165    75 brown      light      blue            47   fema…
##  8 R5-D4 Tatooine      97    32 &lt;NA&gt;       white, red red             NA   none 
##  9 Bigg… Tatooine     183    84 black      light      brown           24   male 
## 10 Obi-… Stewjon      182    77 auburn, w… fair       blue-gray       57   male 
## # … with 77 more rows, and 5 more variables: gender &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Muchas de las funciones vistas pueden ir acompañadas de <code>at</code> o o <code>if</code>, como <code>select_at</code> o <code>rename_if</code>, que nos permite hacer <strong>operaciones más finas y personalizadas</strong>. Por ejemplo, vamos a renombrar con <code><a href="https://rdrr.io/pkg/dplyr/man/select_all.html">rename_if()</a></code> las columnas, pasándolas a mayúscula con <code>toupper</code>, pero solo <strong>aquellas que sean de tipo numérico</strong>.</p>
<div class="sourceCode" id="cb1668"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select_all.html">rename_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">toupper</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    HEIGHT  MASS hair_color  skin_color eye_color BIRTH_YEAR sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<div id="crear-nuevas-variables-mutate" class="section level2">
<h2>
<span class="header-section-number">19.4</span> Crear nuevas variables (mutate)<a class="anchor" aria-label="anchor" href="#crear-nuevas-variables-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>A veces no queremos modificar variables ya existentes sino <mark><strong>crear nuevas variables/columnas</strong></mark> en base a variables ya existentes. Para ello tenemos la opción de <code><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate()</a></code> que nos permite crear una nueva variable en función de las existentes. Para empezar, vamos a crear una nueva variable <code>height_m</code> cuyo cálculo sea la altura en metros (la variable original <code>height</code> está en centímetros).</p>
<div class="sourceCode" id="cb1670"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mutate: nos añade nuevas columnas usando funciones</span>
<span class="co"># aplicadas a nuestras variables</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># altura en metros</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, height_m &lt;dbl&gt;</code></pre>
<p>Recuerda que para <strong>ver todas las columnas</strong> debes indicarle que quieres imprimir todas.</p>
<div class="sourceCode" id="cb1672"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    height_m
##       &lt;dbl&gt;
##  1     1.72
##  2     1.67
##  3     0.96
##  4     2.02
##  5     1.5 
##  6     1.78
##  7     1.65
##  8     0.97
##  9     1.83
## 10     1.82
## # … with 77 more rows</code></pre>
<p>Otra opción es <strong>quedarnos solo con las columnas nuevas creadas</strong> con <code><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute()</a></code></p>
<div class="sourceCode" id="cb1674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute</a></span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    height_m
##       &lt;dbl&gt;
##  1     1.72
##  2     1.67
##  3     0.96
##  4     2.02
##  5     1.5 
##  6     1.78
##  7     1.65
##  8     0.97
##  9     1.83
## 10     1.82
## # … with 77 more rows</code></pre>
<p>Si queremos <mark><strong>añadir varias variables</strong></mark> en función de las ya existentes podemos hacerlo ya que permite incorporar los datos de forma secuencial sin duplicar órdenes de <code><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate()</a></code> para cada una. Además de pasar la altura a metros, vamos a calcular para cada personaje el IMC.</p>
<div class="sourceCode" id="cb1676"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="co"># Calculamos altura en metros y el IMC</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span>,
         BMI <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="op">(</span><span class="va">height_m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 16
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    height_m   BMI
##       &lt;dbl&gt; &lt;dbl&gt;
##  1     1.72  26.0
##  2     1.67  26.9
##  3     0.96  34.7
##  4     2.02  33.3
##  5     1.5   21.8
##  6     1.78  37.9
##  7     1.65  27.5
##  8     0.97  34.0
##  9     1.83  25.1
## 10     1.82  23.2
## # … with 77 more rows</code></pre>
<p>Como ves <strong>por defecto añade las columnas al final</strong> pero podemos <strong>reordenar las columnas</strong> como ya hemos visto.</p>
<div class="sourceCode" id="cb1678"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span>,
         BMI <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="op">(</span><span class="va">height_m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/relocate.html">relocate</a></span><span class="op">(</span><span class="va">height_m</span>, <span class="va">BMI</span>, .after <span class="op">=</span> <span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 16
##    name   height_m   BMI height  mass hair_color skin_color eye_color birth_year
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke …     1.72  26.0    172    77 blond      fair       blue            19  
##  2 C-3PO      1.67  26.9    167    75 &lt;NA&gt;       gold       yellow         112  
##  3 R2-D2      0.96  34.7     96    32 &lt;NA&gt;       white, bl… red             33  
##  4 Darth…     2.02  33.3    202   136 none       white      yellow          41.9
##  5 Leia …     1.5   21.8    150    49 brown      light      brown           19  
##  6 Owen …     1.78  37.9    178   120 brown, gr… light      blue            52  
##  7 Beru …     1.65  27.5    165    75 brown      light      blue            47  
##  8 R5-D4      0.97  34.0     97    32 &lt;NA&gt;       white, red red             NA  
##  9 Biggs…     1.83  25.1    183    84 black      light      brown           24  
## 10 Obi-W…     1.82  23.2    182    77 auburn, w… fair       blue-gray       57  
## # … with 77 more rows, and 7 more variables: sex &lt;chr&gt;, gender &lt;chr&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;</code></pre>
<p>También podemos pasarle una <strong>función propia que queramos definir</strong>, no solo funciones de <code>R</code>. Vamos a definir la función que nos calcula el IMC, a la que llamaremos <code>BMI_fun</code>, que necesita solo de dos argumentos: la altura en metros y el peso.</p>
<div class="sourceCode" id="cb1680"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BMI_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span>, <span class="va">h</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">m</span> <span class="op">/</span> <span class="va">h</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">BMI_fun</span><span class="op">(</span><span class="fl">90</span>, <span class="fl">1.6</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 35.15625</code></pre>
<p>La función definida como <code>BMI_fun()</code> podemos ahora aplicarla dentro de <code><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate()</a></code>.</p>
<div class="sourceCode" id="cb1682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span>,
         BMI <span class="op">=</span> <span class="fu">BMI_fun</span><span class="op">(</span><span class="va">mass</span>, <span class="va">height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Las movemos al inicio (por defecto las mete al final)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/relocate.html">relocate</a></span><span class="op">(</span><span class="va">height_m</span>, <span class="va">BMI</span>, .after <span class="op">=</span> <span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 16
##    name   height_m   BMI height  mass hair_color skin_color eye_color birth_year
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke …     1.72  26.0    172    77 blond      fair       blue            19  
##  2 C-3PO      1.67  26.9    167    75 &lt;NA&gt;       gold       yellow         112  
##  3 R2-D2      0.96  34.7     96    32 &lt;NA&gt;       white, bl… red             33  
##  4 Darth…     2.02  33.3    202   136 none       white      yellow          41.9
##  5 Leia …     1.5   21.8    150    49 brown      light      brown           19  
##  6 Owen …     1.78  37.9    178   120 brown, gr… light      blue            52  
##  7 Beru …     1.65  27.5    165    75 brown      light      blue            47  
##  8 R5-D4      0.97  34.0     97    32 &lt;NA&gt;       white, red red             NA  
##  9 Biggs…     1.83  25.1    183    84 black      light      brown           24  
## 10 Obi-W…     1.82  23.2    182    77 auburn, w… fair       blue-gray       57  
## # … with 77 more rows, and 7 more variables: sex &lt;chr&gt;, gender &lt;chr&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;</code></pre>
<p>También se pueden aplicar funciones más complejas como la función <code>map()</code> del paquete <a href="http://purrr.tidyverse.org">purrr</a> para manejo de listas: dado que las listas no se pueden vectorizar, esta función nos permite <strong>aplicar operaciones a listas, elemento a elemento de cada una de ellas</strong>. Veamos un ejemplo: imagina que queremos calcular el número de películas en las que sale cada personaje de la saga.</p>
<div class="sourceCode" id="cb1684"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Películas de los 3 primeros personajes</span>
<span class="va">starwars</span><span class="op">$</span><span class="va">films</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]
## [1] "The Empire Strikes Back" "Revenge of the Sith"    
## [3] "Return of the Jedi"      "A New Hope"             
## [5] "The Force Awakens"      
## 
## [[2]]
## [1] "The Empire Strikes Back" "Attack of the Clones"   
## [3] "The Phantom Menace"      "Revenge of the Sith"    
## [5] "Return of the Jedi"      "A New Hope"             
## 
## [[3]]
## [1] "The Empire Strikes Back" "Attack of the Clones"   
## [3] "The Phantom Menace"      "Revenge of the Sith"    
## [5] "Return of the Jedi"      "A New Hope"             
## [7] "The Force Awakens"</code></pre>
<p>Las películas de cada personaje están en <strong>modo lista</strong>: no podíamos guardarlo en un <code>data.frame</code> ya que cada personaje ha podido participar en un número distinto (en una tabla, todas las columnas tienen la misma longitud). Para saber la <strong>cantidad de películas</strong> en las que ha participado el primer personaje basta con usar el comando <code><a href="https://rdrr.io/r/base/length.html">length()</a></code> (nos dará el número de elementos de la lista).</p>
<div class="sourceCode" id="cb1686"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">$</span><span class="va">films</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p><strong>¿Cómo aplicar dicha a función a cada personaje?</strong> Con <code>map()</code> y la función a aplicar en cada elemento de la lista.</p>
<div class="sourceCode" id="cb1688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mapeamos la lista con length</span>
<span class="va">n_films</span> <span class="op">&lt;-</span> <span class="va">starwars</span><span class="op">$</span><span class="va">films</span> <span class="op">%&gt;%</span> <span class="fu">map</span><span class="op">(</span><span class="va">length</span><span class="op">)</span>
<span class="va">n_films</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]
## [1] 5
## 
## [[2]]
## [1] 6
## 
## [[3]]
## [1] 7
## 
## [[4]]
## [1] 4
## 
## [[5]]
## [1] 5</code></pre>
<p>Si te fijas con los 5 primeros, lo que nos devuelve por defecto a su vez una lista, cuando a nosotros nos gustaría que nos <mark><strong>devolviera un vector que poder incluir como columna</strong></mark>. Para ello existen diversas funciones como <code>map_chr()</code>, <code>map_dbl()</code> para devolverlo en un formato concreto (caracter o numérico).</p>
<div class="sourceCode" id="cb1690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mapeamos la lista con length pero devolvemos un vector de números enteros</span>
<span class="va">starwars</span><span class="op">$</span><span class="va">films</span> <span class="op">%&gt;%</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">length</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 5 6 7 4 5 3 3 1 1 6 3 2 5 4 1 3 3 1 5 5 3 1 1 2 1 2 1 1 1 1 1 3 1 2 1 1 1 2
## [39] 1 1 2 1 1 3 1 1 1 3 3 3 2 2 2 1 3 2 1 1 1 2 2 1 1 2 2 1 1 1 1 1 1 1 2 1 1 2
## [77] 1 1 2 2 1 1 1 1 1 1 3</code></pre>
<p>Ya solo nos falta incorporar dicha operación a una nueva columna con <code><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate()</a></code></p>
<div class="sourceCode" id="cb1692"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"n_peliculas"</span> <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">homeworld</span>, <span class="va">n_peliculas</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    name               homeworld n_peliculas
##    &lt;chr&gt;              &lt;chr&gt;           &lt;int&gt;
##  1 Luke Skywalker     Tatooine            5
##  2 C-3PO              Tatooine            6
##  3 R2-D2              Naboo               7
##  4 Darth Vader        Tatooine            4
##  5 Leia Organa        Alderaan            5
##  6 Owen Lars          Tatooine            3
##  7 Beru Whitesun lars Tatooine            3
##  8 R5-D4              Tatooine            1
##  9 Biggs Darklighter  Tatooine            1
## 10 Obi-Wan Kenobi     Stewjon             6
## # … with 77 more rows</code></pre>
<div id="recategorizar-columnas-cut-y-case_when" class="section level3">
<h3>
<span class="header-section-number">19.4.1</span> Recategorizar columnas (cut y case_when)<a class="anchor" aria-label="anchor" href="#recategorizar-columnas-cut-y-case_when"><i class="fas fa-link"></i></a>
</h3>
<p>Una operación también muy habitual es querer <mark><strong>recategorizar nuestras variables</strong></mark>: tenemos categorías ya existentes o variables numéricas que queremos convertir a categoría (se conocen como factores en <code>R</code>). Supongamos por ejemplo que queremos <strong>crear una categoría para cada registro</strong> en función de su altura: menos de 120, entre 120 y 180, y más de 180. Para ello podemos hacer uso de la función <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, a la que en el argumento <code>breaks</code> le debemos indicar los <strong>«cortes» o saltos de la variable</strong>.</p>
<div class="sourceCode" id="cb1694"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"estat_categoria"</span> <span class="op">=</span>
                 <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">height</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">120</span>, <span class="fl">180</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
      width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    estat_categoria
##    &lt;fct&gt;          
##  1 (120,180]      
##  2 (120,180]      
##  3 (-Inf,120]     
##  4 (180, Inf]     
##  5 (120,180]      
##  6 (120,180]      
##  7 (120,180]      
##  8 (-Inf,120]     
##  9 (180, Inf]     
## 10 (180, Inf]     
## # … with 77 more rows</code></pre>
<p>Recuerda que si quieres <strong>mostrar solo las nuevas columnas</strong> creadas puedes usar <code><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute()</a></code></p>
<div class="sourceCode" id="cb1696"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute</a></span><span class="op">(</span><span class="st">"estat_categoria"</span> <span class="op">=</span>
              <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">height</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">120</span>, <span class="fl">180</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    estat_categoria
##    &lt;fct&gt;          
##  1 (120,180]      
##  2 (120,180]      
##  3 (-Inf,120]     
##  4 (180, Inf]     
##  5 (120,180]      
##  6 (120,180]      
##  7 (120,180]      
##  8 (-Inf,120]     
##  9 (180, Inf]     
## 10 (180, Inf]     
## # … with 77 more rows</code></pre>
<p>Si queremos que la categoría tenga un nombre explícito (y no el intervalo en sí), podemos indicárselo en <code>labels =</code> el vector de nombres de las categorías.</p>
<div class="sourceCode" id="cb1698"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute</a></span><span class="op">(</span><span class="st">"estat_categoria"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">height</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">120</span>, <span class="fl">180</span>, <span class="cn">Inf</span><span class="op">)</span>,
                                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bajos"</span>, <span class="st">"medios"</span>, <span class="st">"altos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    estat_categoria
##    &lt;fct&gt;          
##  1 medios         
##  2 medios         
##  3 bajos          
##  4 altos          
##  5 medios         
##  6 medios         
##  7 medios         
##  8 bajos          
##  9 altos          
## 10 altos          
## # … with 77 more rows</code></pre>
<p>Otra opción es hacerlo con la función <code>factor</code> que nos transforma una variable en categoría.</p>
<div class="sourceCode" id="cb1700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Vamos a categorizar en bajitos a los que miden menos de 180 cm</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>talla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">height</span> <span class="op">&lt;</span> <span class="fl">180</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bajos"</span>, <span class="st">"altos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, talla &lt;fct&gt;</code></pre>
<p>Otra opción para no encadenar <code>if-else</code> anidados es <code>case_when</code>, en el que le podemos indicar que valores asignamos en función de condiciones. Vamos a crearuna variable nueva <code>altura</code></p>
<ul>
<li>Si <code>height &gt; 180</code> –&gt; serán <code>"altos"</code>
</li>
<li>Si no se cumple lo anterior y <code>height &gt; 120</code> –&gt; serán <code>"bajos"</code>
</li>
<li>Si no se cumple lo anterior y <code>height &gt; 0</code> –&gt; serán <code>"enanos"</code>
</li>
<li>Si no se cumple lo anterior –&gt; serán <code>"ausentes"</code>
</li>
</ul>
<div class="sourceCode" id="cb1702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute</a></span><span class="op">(</span>altura <span class="op">=</span>
              <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/case_when.html">case_when</a></span><span class="op">(</span><span class="va">height</span> <span class="op">&gt;</span> <span class="fl">180</span> <span class="op">~</span> <span class="st">"altos"</span>,
                        <span class="va">height</span> <span class="op">&gt;</span> <span class="fl">120</span> <span class="op">~</span> <span class="st">"bajos"</span>,
                        <span class="va">height</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"enanos"</span>,
                        <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"ausentes"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    altura
##    &lt;chr&gt; 
##  1 bajos 
##  2 bajos 
##  3 enanos
##  4 altos 
##  5 bajos 
##  6 bajos 
##  7 bajos 
##  8 enanos
##  9 altos 
## 10 altos 
## # … with 77 more rows</code></pre>
</div>
</div>
<div id="datos-ausentes-y-outliers-drop_na-y-mutate" class="section level2">
<h2>
<span class="header-section-number">19.5</span> Datos ausentes y outliers (drop_na y mutate)<a class="anchor" aria-label="anchor" href="#datos-ausentes-y-outliers-drop_na-y-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>Como ya vimos en <a href="ejercicios-recopilados.html#vectores">Tipos de datos I: vectores</a>, los datos ausentes en <code>R</code> pueden venir representados por valores <code>NA</code> o por valores <code>NaN</code> (en realidad este no sería ausente siendo estrictos, es simplemente un resultado no numérico dentro de los reales). <strong>¿Qué hacer con dichos valores?</strong></p>
<p>Una primera opción puede ser <mark><strong>eliminar los registros que contengan campos ausentes</strong></mark> en alguna de sus variables, haciendo uso de la función <code><a href="https://rdrr.io/pkg/tidyr/man/drop_na.html">drop_na()</a></code>.</p>
<div class="sourceCode" id="cb1704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sk…    172    77 blond       fair       blue            19   male  mascu…
## 2 Obi-Wan…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 3 Anakin …    188    84 blond       fair       blue            41.9 male  mascu…
## 4 Chewbac…    228   112 brown       unknown    blue           200   male  mascu…
## 5 Wedge A…    170    77 brown       fair       hazel           21   male  mascu…
## 6 Darth M…    175    80 none        red        yellow          54   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Como ves solo 6 de los 87 registros tienen todos los campos completos. Como quizás <strong>no todos los campos sean igual de importantes</strong> en nuestros, podemos indicarle que nos elimine aquellos registros que tengan datos ausentes <strong>algunos campos en concreto</strong> (o una coelcción de ellos)</p>
<div class="sourceCode" id="cb1706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">mass</span>, <span class="va">height</span>, <span class="va">sex</span>, <span class="va">gender</span>, <span class="va">birth_year</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 36 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 Biggs …    183    84 black       light      brown           24   male  mascu…
##  9 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 10 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
## # … with 26 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Otra opción es <mark><strong>imputar su valor</strong></mark> en el caso de variables cuantitativas por, por ejemplo, la <strong>media de la variable sin datos ausentes</strong>. Con <code><a href="https://rdrr.io/pkg/dplyr/man/across.html">across()</a></code> podremos seleccionar todas las columnas que cumplan ciertas condiciones que le indiquemos, para después aplicar la función.</p>
<div class="sourceCode" id="cb1708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="co"># Variables cuanti</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,
                <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             87.6 none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p> </p>
<p>Muchas veces tendremos variables con <strong>valores muy alejados de la centralidad</strong>, centralidad normalmente entendida como media o mediana, valores muy extremos (conocidos como <mark><strong>valores atípicos o outliers</strong></mark>).</p>
<ul>
<li><p><strong>Respecto a la mediana/percentiles (iqr)</strong>: una definición de outlier muy habitual es definirlo como un <strong>valor muy alejado del primer/tercer cuartil</strong>. La definición que se suele usar es que el dato sea interior/superior al primer/tercer cuartil una amplitud de X veces el <strong>rango intercuartílico</strong> (conocido como <strong>IQR, calculado como el tercer cuartil menos el primer cuartil</strong>) por debajo/encima.</p></li>
<li><p><strong>Respecto a la media (gesd)</strong>: el criterio utilizado suele ser el conocido como GESD (Generlized Extreme Studentized Deviate Test), un contraste de hipótesis cuya hipótesis nula es que no hay atípicos en los datos. Puedes ver la formulación matemática en <a href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h3.htm" class="uri">https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h3.htm</a></p></li>
</ul>
<p>Para su localización automática usaremos el paquete <a href="https://github.com/business-science/anomalize">anomalize</a>, y la función homónima de dicho paquete, indicándole la columna individual en la que queremos detectar outliers y el método a usar. Con el método <code>method = "gesd"</code> realizaremos el contraste dato a dato de forma secuencial (si hay outlier lo quita individualmente y vuelve a ejecutarlo). Con <code>method = "iqr"</code>, ese factor <code>X</code> que nos distanciamos del primer y tercer cuartil es calculado como <code>0.15/alpha</code>, de forma que con <code>alpha = 0.05</code> (por ejemplo), dicho factor sería <code>X = 3</code>. Es <strong>MUY IMPORTANTE</strong> quitar antes los valores ausentes (para que pueda ejecutarse correctamente).</p>
<div class="sourceCode" id="cb1710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/anomalize">anomalize</a></span><span class="op">)</span>
<span class="co"># Importante: quitar antes missings</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/anomalize/man/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">mass</span>, method <span class="op">=</span> <span class="st">"gesd"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 59 × 17
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 49 more rows, and 8 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, mass_l1 &lt;dbl&gt;,
## #   mass_l2 &lt;dbl&gt;, anomaly &lt;chr&gt;</code></pre>
<p>En las columnas <code>mass_l1</code> y <code>mass_l2</code> se nos han guardado los límites para considerar o no outlier, y en <code>anomaly</code> tendremos si el valor es un outlier o no. Podemos renombrar dicha columna y recategorizarlo con <code>TRUE/FALSE</code></p>
<div class="sourceCode" id="cb1712"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/anomalize/man/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">mass</span>, method <span class="op">=</span> <span class="st">"gesd"</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename</a></span><span class="op">(</span>outlier <span class="op">=</span> <span class="va">anomaly</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="co"># Eliminamos la variables auxiliares creadas</span>
        <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mass_l1</span>, <span class="va">mass_l2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>outlier <span class="op">=</span> <span class="op">(</span><span class="va">outlier</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 59 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    outlier
##    &lt;lgl&gt;  
##  1 FALSE  
##  2 FALSE  
##  3 TRUE   
##  4 TRUE   
##  5 FALSE  
##  6 TRUE   
##  7 FALSE  
##  8 FALSE  
##  9 FALSE  
## 10 FALSE  
## # … with 49 more rows</code></pre>
<p>Dicha variable auxiliar la podremos usar para <strong>decidir si incluir o no el registro</strong> en futuros pasos, pero también <strong>podemos usarla para imputarle un valor</strong> (por ejemplo, la media).</p>
<div class="sourceCode" id="cb1714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/anomalize/man/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">mass</span>, method <span class="op">=</span> <span class="st">"gesd"</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename</a></span><span class="op">(</span>outlier <span class="op">=</span> <span class="va">anomaly</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="co"># Eliminamos la variables auxiliares creadas</span>
        <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mass_l1</span>, <span class="va">mass_l2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>outlier <span class="op">=</span> <span class="op">(</span><span class="va">outlier</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,
               mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">outlier</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span>, <span class="va">mass</span><span class="op">)</span><span class="op">)</span>,
      width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 59 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172  77   blond         fair        blue     
##  2 C-3PO                 167  75   &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96  97.3 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202  97.3 none          white       yellow   
##  5 Leia Organa           150  49   brown         light       brown    
##  6 Owen Lars             178  97.3 brown, grey   light       blue     
##  7 Beru Whitesun lars    165  75   brown         light       blue     
##  8 R5-D4                  97  32   &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183  84   black         light       brown    
## 10 Obi-Wan Kenobi        182  77   auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    outlier
##    &lt;lgl&gt;  
##  1 FALSE  
##  2 FALSE  
##  3 TRUE   
##  4 TRUE   
##  5 FALSE  
##  6 TRUE   
##  7 FALSE  
##  8 FALSE  
##  9 FALSE  
## 10 FALSE  
## # … with 49 more rows</code></pre>
</div>
<div id="visualizar-el-flujo-de-datos" class="section level2">
<h2>
<span class="header-section-number">19.6</span> Visualizar el flujo de datos<a class="anchor" aria-label="anchor" href="#visualizar-el-flujo-de-datos"><i class="fas fa-link"></i></a>
</h2>
<p>Antes de pasar a los ejercicios, existe una reciente herramienta que nos va a permitir entender mejor y <mark><strong>visualizar el flujo de trabajo</strong></mark> de las funciones que hemos visto en este entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a>: <a href="https://tidydatatutor.com/" class="uri">https://tidydatatutor.com/</a>. Basta con poner el código que queremos ejecutar, y nos <mark><strong>muestra visualmente las operaciones</strong></mark> en los datos.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-641"></span>
<img src="img/tidytutor.jpg" alt="Tidytutor." width="70%"><p class="caption">
Imagen/gráfica 19.3: Tidytutor.
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-642"></span>
<img src="img/tidytutor1.jpg" alt="Tidytutor." width="70%"><p class="caption">
Imagen/gráfica 19.4: Tidytutor.
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-643"></span>
<img src="img/tidytutor2.jpg" alt="Tidytutor." width="70%"><p class="caption">
Imagen/gráfica 19.5: Tidytutor.
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-644"></span>
<img src="img/tidytutor3.jpg" alt="Tidytutor." width="70%"><p class="caption">
Imagen/gráfica 19.6: Tidytutor.
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-645"></span>
<img src="img/tidytutor4.jpg" alt="Tidytutor." width="70%"><p class="caption">
Imagen/gráfica 19.7: Tidytutor.
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-646"></span>
<img src="img/tidytutor5.jpg" alt="Tidytutor." width="70%"><p class="caption">
Imagen/gráfica 19.8: Tidytutor.
</p>
</div>
</div>
<div id="ejercicios-11" class="section level2">
<h2>
<span class="header-section-number">19.7</span> 📝 Ejercicios<a class="anchor" aria-label="anchor" href="#ejercicios-11"><i class="fas fa-link"></i></a>
</h2>
<p>(haz click en las flechas para ver soluciones)</p>
<details><p><summary>📝<strong>Ejercicio 1</strong>: carga el conjunto de datos <code>starwars</code> y determina el tipo de variables, el númwero de filas y el número de columnas.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># carga</span>
<span class="va">starwars</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dimensiones</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 87</code></pre>
<div class="sourceCode" id="cb1720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 14</code></pre>
<div class="sourceCode" id="cb1722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 87 14</code></pre>
<div class="sourceCode" id="cb1724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Tipos de variables</span>
<span class="fu"><a href="https://rdrr.io/pkg/pillar/man/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 87
## Columns: 14
## $ name       &lt;chr&gt; "Luke Skywalker", "C-3PO", "R2-D2", "Darth Vader", "Leia Or…
## $ height     &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188, 180, 2…
## $ mass       &lt;dbl&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 84.0, 77.…
## $ hair_color &lt;chr&gt; "blond", NA, NA, "none", "brown", "brown, grey", "brown", N…
## $ skin_color &lt;chr&gt; "fair", "gold", "white, blue", "white", "light", "light", "…
## $ eye_color  &lt;chr&gt; "blue", "yellow", "red", "yellow", "brown", "blue", "blue",…
## $ birth_year &lt;dbl&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, NA, 24.0, 57.0, …
## $ sex        &lt;chr&gt; "male", "none", "none", "male", "female", "male", "female",…
## $ gender     &lt;chr&gt; "masculine", "masculine", "masculine", "masculine", "femini…
## $ homeworld  &lt;chr&gt; "Tatooine", "Tatooine", "Naboo", "Tatooine", "Alderaan", "T…
## $ species    &lt;chr&gt; "Human", "Droid", "Droid", "Human", "Human", "Human", "Huma…
## $ films      &lt;list&gt; &lt;"The Empire Strikes Back", "Revenge of the Sith", "Return…
## $ vehicles   &lt;list&gt; &lt;"Snowspeeder", "Imperial Speeder Bike"&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, "Imp…
## $ starships  &lt;list&gt; &lt;"X-wing", "Imperial shuttle"&gt;, &lt;&gt;, &lt;&gt;, "TIE Advanced x1",…</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 2</strong>: del conjunto <code>starwars</code> encuentra todos los personajes cuyo peso esté entre 60kg y 90kg. Imprime todas las columnas del filtro.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># todas columnas</span>
<span class="va">filtro</span> <span class="op">&lt;-</span>
  <span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/between.html">between</a></span><span class="op">(</span><span class="va">mass</span>, <span class="fl">60</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">filtro</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 14
##    name               height  mass hair_color    skin_color eye_color birth_year
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke Skywalker        172    77 blond         fair       blue            19  
##  2 C-3PO                 167    75 &lt;NA&gt;          gold       yellow         112  
##  3 Beru Whitesun lars    165    75 brown         light      blue            47  
##  4 Biggs Darklighter     183    84 black         light      brown           24  
##  5 Obi-Wan Kenobi        182    77 auburn, white fair       blue-gray       57  
##  6 Anakin Skywalker      188    84 blond         fair       blue            41.9
##  7 Han Solo              180    80 brown         fair       brown           29  
##  8 Greedo                173    74 &lt;NA&gt;          green      black           44  
##  9 Wedge Antilles        170    77 brown         fair       hazel           21  
## 10 Palpatine             170    75 grey          pale       yellow          82  
##    sex    gender    homeworld species films     vehicles  starships
##    &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1 male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2 none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3 female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4 male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5 male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##  6 male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [3]&gt;
##  7 male   masculine Corellia  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [2]&gt;
##  8 male   masculine Rodia     Rodian  &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9 male   masculine Corellia  Human   &lt;chr [3]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
## 10 male   masculine Naboo     Human   &lt;chr [5]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
## # … with 22 more rows</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 3</strong>: añadido al filtro anterior, encuentra todos los personajes que además tengan los ojos que no sean azules.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1728"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># todas columnas</span>
<span class="va">filtro</span> <span class="op">&lt;-</span>
  <span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/between.html">between</a></span><span class="op">(</span><span class="va">mass</span>, <span class="fl">60</span>, <span class="fl">90</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">eye_color</span> <span class="op">!=</span> <span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">filtro</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 27 × 14
##    name              height  mass hair_color    skin_color   eye_color
##    &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    
##  1 C-3PO                167  75   &lt;NA&gt;          gold         yellow   
##  2 Biggs Darklighter    183  84   black         light        brown    
##  3 Obi-Wan Kenobi       182  77   auburn, white fair         blue-gray
##  4 Han Solo             180  80   brown         fair         brown    
##  5 Greedo               173  74   &lt;NA&gt;          green        black    
##  6 Wedge Antilles       170  77   brown         fair         hazel    
##  7 Palpatine            170  75   grey          pale         yellow   
##  8 Boba Fett            183  78.2 black         fair         brown    
##  9 Lando Calrissian     177  79   black         dark         brown    
## 10 Ackbar               180  83   none          brown mottle orange   
##    birth_year sex   gender    homeworld species      films     vehicles 
##         &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;        &lt;list&gt;    &lt;list&gt;   
##  1      112   none  masculine Tatooine  Droid        &lt;chr [6]&gt; &lt;chr [0]&gt;
##  2       24   male  masculine Tatooine  Human        &lt;chr [1]&gt; &lt;chr [0]&gt;
##  3       57   male  masculine Stewjon   Human        &lt;chr [6]&gt; &lt;chr [1]&gt;
##  4       29   male  masculine Corellia  Human        &lt;chr [4]&gt; &lt;chr [0]&gt;
##  5       44   male  masculine Rodia     Rodian       &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       21   male  masculine Corellia  Human        &lt;chr [3]&gt; &lt;chr [1]&gt;
##  7       82   male  masculine Naboo     Human        &lt;chr [5]&gt; &lt;chr [0]&gt;
##  8       31.5 male  masculine Kamino    Human        &lt;chr [3]&gt; &lt;chr [0]&gt;
##  9       31   male  masculine Socorro   Human        &lt;chr [2]&gt; &lt;chr [0]&gt;
## 10       41   male  masculine Mon Cala  Mon Calamari &lt;chr [2]&gt; &lt;chr [0]&gt;
##    starships
##    &lt;list&gt;   
##  1 &lt;chr [0]&gt;
##  2 &lt;chr [1]&gt;
##  3 &lt;chr [5]&gt;
##  4 &lt;chr [2]&gt;
##  5 &lt;chr [0]&gt;
##  6 &lt;chr [1]&gt;
##  7 &lt;chr [0]&gt;
##  8 &lt;chr [1]&gt;
##  9 &lt;chr [1]&gt;
## 10 &lt;chr [0]&gt;
## # … with 17 more rows</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 4</strong>: añadido al filtro anterior, encuentra todos los personajes que además tengan menos de 100 años.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># todas columnas</span>
<span class="va">filtro</span> <span class="op">&lt;-</span>
  <span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/between.html">between</a></span><span class="op">(</span><span class="va">mass</span>, <span class="fl">60</span>, <span class="fl">90</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">eye_color</span> <span class="op">!=</span> <span class="st">"blue"</span> <span class="op">&amp;</span>
           <span class="va">birth_year</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">filtro</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 14
##    name              height  mass hair_color    skin_color   eye_color
##    &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    
##  1 Biggs Darklighter    183  84   black         light        brown    
##  2 Obi-Wan Kenobi       182  77   auburn, white fair         blue-gray
##  3 Han Solo             180  80   brown         fair         brown    
##  4 Greedo               173  74   &lt;NA&gt;          green        black    
##  5 Wedge Antilles       170  77   brown         fair         hazel    
##  6 Palpatine            170  75   grey          pale         yellow   
##  7 Boba Fett            183  78.2 black         fair         brown    
##  8 Lando Calrissian     177  79   black         dark         brown    
##  9 Ackbar               180  83   none          brown mottle orange   
## 10 Jar Jar Binks        196  66   none          orange       orange   
## 11 Darth Maul           175  80   none          red          yellow   
## 12 Mace Windu           188  84   none          dark         brown    
## 13 Ki-Adi-Mundi         198  82   white         pale         yellow   
## 14 Plo Koon             188  80   none          orange       black    
## 15 Jango Fett           183  79   black         tan          brown    
##    birth_year sex   gender    homeworld    species      films     vehicles 
##         &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;        &lt;list&gt;    &lt;list&gt;   
##  1       24   male  masculine Tatooine     Human        &lt;chr [1]&gt; &lt;chr [0]&gt;
##  2       57   male  masculine Stewjon      Human        &lt;chr [6]&gt; &lt;chr [1]&gt;
##  3       29   male  masculine Corellia     Human        &lt;chr [4]&gt; &lt;chr [0]&gt;
##  4       44   male  masculine Rodia        Rodian       &lt;chr [1]&gt; &lt;chr [0]&gt;
##  5       21   male  masculine Corellia     Human        &lt;chr [3]&gt; &lt;chr [1]&gt;
##  6       82   male  masculine Naboo        Human        &lt;chr [5]&gt; &lt;chr [0]&gt;
##  7       31.5 male  masculine Kamino       Human        &lt;chr [3]&gt; &lt;chr [0]&gt;
##  8       31   male  masculine Socorro      Human        &lt;chr [2]&gt; &lt;chr [0]&gt;
##  9       41   male  masculine Mon Cala     Mon Calamari &lt;chr [2]&gt; &lt;chr [0]&gt;
## 10       52   male  masculine Naboo        Gungan       &lt;chr [2]&gt; &lt;chr [0]&gt;
## 11       54   male  masculine Dathomir     Zabrak       &lt;chr [1]&gt; &lt;chr [1]&gt;
## 12       72   male  masculine Haruun Kal   Human        &lt;chr [3]&gt; &lt;chr [0]&gt;
## 13       92   male  masculine Cerea        Cerean       &lt;chr [3]&gt; &lt;chr [0]&gt;
## 14       22   male  masculine Dorin        Kel Dor      &lt;chr [3]&gt; &lt;chr [0]&gt;
## 15       66   male  masculine Concord Dawn Human        &lt;chr [1]&gt; &lt;chr [0]&gt;
##    starships
##    &lt;list&gt;   
##  1 &lt;chr [1]&gt;
##  2 &lt;chr [5]&gt;
##  3 &lt;chr [2]&gt;
##  4 &lt;chr [0]&gt;
##  5 &lt;chr [1]&gt;
##  6 &lt;chr [0]&gt;
##  7 &lt;chr [1]&gt;
##  8 &lt;chr [1]&gt;
##  9 &lt;chr [0]&gt;
## 10 &lt;chr [0]&gt;
## 11 &lt;chr [1]&gt;
## 12 &lt;chr [0]&gt;
## 13 &lt;chr [0]&gt;
## 14 &lt;chr [1]&gt;
## 15 &lt;chr [0]&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 5</strong>: añadido al filtro anterior, selecciona solo las columnas <code>name, mass, eye_color, birth_year</code></summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1732"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Solo name, mass, eye_color, birth_year</span>
<span class="va">filtro</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">mass</span>, <span class="va">eye_color</span>, <span class="va">birth_year</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 4
##    name               mass eye_color birth_year
##    &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
##  1 Biggs Darklighter  84   brown           24  
##  2 Obi-Wan Kenobi     77   blue-gray       57  
##  3 Han Solo           80   brown           29  
##  4 Greedo             74   black           44  
##  5 Wedge Antilles     77   hazel           21  
##  6 Palpatine          75   yellow          82  
##  7 Boba Fett          78.2 brown           31.5
##  8 Lando Calrissian   79   brown           31  
##  9 Ackbar             83   orange          41  
## 10 Jar Jar Binks      66   orange          52  
## 11 Darth Maul         80   yellow          54  
## 12 Mace Windu         84   brown           72  
## 13 Ki-Adi-Mundi       82   yellow          92  
## 14 Plo Koon           80   black           22  
## 15 Jango Fett         79   brown           66</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 5</strong>: selecciona solo las columnas que contengan variables numéricas.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1734"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    height  mass birth_year
##     &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77       19  
##  2    167    75      112  
##  3     96    32       33  
##  4    202   136       41.9
##  5    150    49       19  
##  6    178   120       52  
##  7    165    75       47  
##  8     97    32       NA  
##  9    183    84       24  
## 10    182    77       57  
## # … with 77 more rows</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 6</strong>: añadido a la selección anterior, coloca los años de nacimiento como primera columna y cambia los nombres a castellano.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/relocate.html">relocate</a></span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, .after <span class="op">=</span> <span class="va">birth_year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename</a></span><span class="op">(</span>edad <span class="op">=</span> <span class="va">birth_year</span>, altura <span class="op">=</span> <span class="va">height</span>, peso <span class="op">=</span> <span class="va">mass</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##     edad altura  peso
##    &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
##  1  19      172    77
##  2 112      167    75
##  3  33       96    32
##  4  41.9    202   136
##  5  19      150    49
##  6  52      178   120
##  7  47      165    75
##  8  NA       97    32
##  9  24      183    84
## 10  57      182    77
## # … with 77 more rows</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 7</strong>: calcula una nueva columna que indique el número de naves que ha pilotado cada persona (escribe <code><a href="https://rdrr.io/pkg/dplyr/man/starwars.html">? starwars</a></code> en consola para ver documentación del fichero).</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1738"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars_numero_naves</span> <span class="op">&lt;-</span> 
  <span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>n_naves <span class="op">=</span> <span class="fu">map_chr</span><span class="op">(</span><span class="va">starships</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Imprimimos todas las columnas</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">starwars_numero_naves</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    n_naves
##    &lt;chr&gt;  
##  1 2      
##  2 0      
##  3 0      
##  4 1      
##  5 0      
##  6 0      
##  7 0      
##  8 0      
##  9 1      
## 10 5      
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb1740"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Solo la columna añadida</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute</a></span><span class="op">(</span>n_naves <span class="op">=</span> <span class="fu">map_chr</span><span class="op">(</span><span class="va">starships</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    n_naves
##    &lt;chr&gt;  
##  1 2      
##  2 0      
##  3 0      
##  4 1      
##  5 0      
##  6 0      
##  7 0      
##  8 0      
##  9 1      
## 10 5      
## # … with 77 more rows</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 8</strong>: con la columna anterior añadido, crea una nueva variable <code>TRUE/FALSE</code> que nos diga si ha conducido o no alguna nave, y filtra después solo aquellos personajes que han conducido alguna nave.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1742"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Nueva columna lógica</span>
<span class="va">starwars_numero_naves</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>conducir_nave <span class="op">=</span> <span class="va">n_naves</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">conducir_nave</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 20 × 16
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172  77   blond       fair       blue            19   male  mascu…
##  2 Darth …    202 136   none        white      yellow          41.9 male  mascu…
##  3 Biggs …    183  84   black       light      brown           24   male  mascu…
##  4 Obi-Wa…    182  77   auburn, wh… fair       blue-gray       57   male  mascu…
##  5 Anakin…    188  84   blond       fair       blue            41.9 male  mascu…
##  6 Chewba…    228 112   brown       unknown    blue           200   male  mascu…
##  7 Han So…    180  80   brown       fair       brown           29   male  mascu…
##  8 Wedge …    170  77   brown       fair       hazel           21   male  mascu…
##  9 Jek To…    180 110   brown       fair       blue            NA   male  mascu…
## 10 Boba F…    183  78.2 black       fair       brown           31.5 male  mascu…
## 11 Lando …    177  79   black       dark       brown           31   male  mascu…
## 12 Arvel …     NA  NA   brown       fair       brown           NA   male  mascu…
## 13 Nien N…    160  68   none        grey       black           NA   male  mascu…
## 14 Ric Ol…    183  NA   brown       fair       blue            NA   &lt;NA&gt;  &lt;NA&gt;  
## 15 Darth …    175  80   none        red        yellow          54   male  mascu…
## 16 Plo Ko…    188  80   none        orange     black           22   male  mascu…
## 17 Gregar…    185  85   black       dark       brown           NA   male  mascu…
## 18 Grievo…    216 159   none        brown, wh… green, y…       NA   male  mascu…
## 19 Poe Da…     NA  NA   brown       light      brown           NA   male  mascu…
## 20 Padmé …    165  45   brown       light      brown           46   fema… femin…
## # … with 7 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_naves &lt;chr&gt;, conducir_nave &lt;lgl&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 9</strong>: calcula el número de películas en las que han salido y ordena a los personajes de mayor a menor número de películas en las que ha aparecido</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1744"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># Calculamos primero el número de películas</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/desc.html">desc</a></span><span class="op">(</span><span class="va">n_films</span><span class="op">)</span><span class="op">)</span> <span class="co"># Ordenamos de mayor a menor</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
##  4 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Chewba…    228   112 brown       unknown    blue           200   male  mascu…
##  7 Yoda        66    17 white       green      brown          896   male  mascu…
##  8 Palpat…    170    75 grey        pale       yellow          82   male  mascu…
##  9 Darth …    202   136 none        white      yellow          41.9 male  mascu…
## 10 Han So…    180    80 brown       fair       brown           29   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 10</strong>: selecciona 7 personajes al azar.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1746"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Una extracción aleatoria</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 14
##   name    height   mass hair_color skin_color  eye_color birth_year sex   gender
##   &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Darth …    175   80   none       red         yellow          54   male  mascu…
## 2 Boba F…    183   78.2 black      fair        brown           31.5 male  mascu…
## 3 Jabba …    175 1358   &lt;NA&gt;       green-tan,… orange         600   herm… mascu…
## 4 Zam We…    168   55   blonde     fair, gree… yellow          NA   fema… femin…
## 5 Ki-Adi…    198   82   white      pale        yellow          92   male  mascu…
## 6 Mas Am…    196   NA   none       blue        blue            NA   male  mascu…
## 7 Shmi S…    163   NA   black      fair        brown           72   fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb1748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># otra (que sale distinta, claro)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Bail Pr…    191    NA black       tan        brown             67 male  mascu…
## 2 Dooku       193    80 white       fair       brown            102 male  mascu…
## 3 Obi-Wan…    182    77 auburn, wh… fair       blue-gray         57 male  mascu…
## 4 San Hill    191    NA none        grey       gold              NA male  mascu…
## 5 Sly Moo…    178    48 none        pale       white             NA &lt;NA&gt;  &lt;NA&gt;  
## 6 Cliegg …    183    NA brown       fair       blue              82 male  mascu…
## 7 Greedo      173    74 &lt;NA&gt;        green      black             44 male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 11</strong>: selecciona los 5 personajes que en más películas han salido y los 5 que menos.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1750"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personajes que en más películas han salido (metiendo empates)</span>
<span class="va">starwars</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_max</a></span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 8 × 15
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2        96    32 &lt;NA&gt;        white, bl… red               33 none  mascu…
## 2 C-3PO       167    75 &lt;NA&gt;        gold       yellow           112 none  mascu…
## 3 Obi-Wan…    182    77 auburn, wh… fair       blue-gray         57 male  mascu…
## 4 Luke Sk…    172    77 blond       fair       blue              19 male  mascu…
## 5 Leia Or…    150    49 brown       light      brown             19 fema… femin…
## 6 Chewbac…    228   112 brown       unknown    blue             200 male  mascu…
## 7 Yoda         66    17 white       green      brown            896 male  mascu…
## 8 Palpati…    170    75 grey        pale       yellow            82 male  mascu…
## # … with 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb1752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personajes que en más películas han salido (sin empates)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_max</a></span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 15
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2        96    32 &lt;NA&gt;        white, bl… red               33 none  mascu…
## 2 C-3PO       167    75 &lt;NA&gt;        gold       yellow           112 none  mascu…
## 3 Obi-Wan…    182    77 auburn, wh… fair       blue-gray         57 male  mascu…
## 4 Luke Sk…    172    77 blond       fair       blue              19 male  mascu…
## 5 Leia Or…    150    49 brown       light      brown             19 fema… femin…
## # … with 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb1754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personajes que en menos películas han salido (metiendo empates)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_min</a></span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 46 × 15
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 R5-D4        97    32 &lt;NA&gt;       white, red red               NA none  mascu…
##  2 Biggs D…    183    84 black      light      brown             24 male  mascu…
##  3 Greedo      173    74 &lt;NA&gt;       green      black             44 male  mascu…
##  4 Jek Ton…    180   110 brown      fair       blue              NA male  mascu…
##  5 IG-88       200   140 none       metal      red               15 none  mascu…
##  6 Bossk       190   113 none       green      red               53 male  mascu…
##  7 Lobot       175    79 none       light      blue              37 male  mascu…
##  8 Mon Mot…    150    NA auburn     fair       blue              48 fema… femin…
##  9 Arvel C…     NA    NA brown      fair       brown             NA male  mascu…
## 10 Wicket …     88    20 brown      brown      brown              8 male  mascu…
## # … with 36 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb1756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personajes que en menos películas han salido (sin empates)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu">map_int</span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/slice.html">slice_min</a></span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 15
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R5-D4         97    32 &lt;NA&gt;       white, red red               NA none  mascu…
## 2 Biggs Da…    183    84 black      light      brown             24 male  mascu…
## 3 Greedo       173    74 &lt;NA&gt;       green      black             44 male  mascu…
## 4 Jek Tono…    180   110 brown      fair       blue              NA male  mascu…
## 5 IG-88        200   140 none       metal      red               15 none  mascu…
## # … with 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 12</strong>: selecciona solo las columnas que se refieren a variables de color (ojos, piel, pelo) (con sufijo <code>"color"</code>)</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Contiene "color" independientemente de que sea sufijo o prefijo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb1760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Contiene "color" como sufijo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<!-- tocstop -->
</details>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="rmarkdown.html"><span class="header-section-number">18</span> Contando los datos: rmarkdown</a></div>
<div class="next"><a href="resumenes.html"><span class="header-section-number">20</span> Resumiendo y relacionado datos</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidyverse"><span class="header-section-number">19</span> Depuración y transformación</a></li>
<li><a class="nav-link" href="#conjunto-starwars"><span class="header-section-number">19.1</span> Conjunto starwars</a></li>
<li>
<a class="nav-link" href="#operaciones-con-filas"><span class="header-section-number">19.2</span> Operaciones con filas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#seleccionar-filas-filter-y-slice"><span class="header-section-number">19.2.1</span> Seleccionar filas (filter y slice)</a></li>
<li><a class="nav-link" href="#reordenar-filas-arrange"><span class="header-section-number">19.2.2</span> Reordenar filas (arrange)</a></li>
<li><a class="nav-link" href="#eliminar-filas-y-duplicados-slice-y-distinct"><span class="header-section-number">19.2.3</span> Eliminar filas y duplicados (slice y distinct)</a></li>
<li><a class="nav-link" href="#a%C3%B1adir-filas-bind_rows"><span class="header-section-number">19.2.4</span> Añadir filas (bind_rows)</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#operaciones-con-columnas"><span class="header-section-number">19.3</span> Operaciones con columnas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#seleccionar-columnas-select"><span class="header-section-number">19.3.1</span> Seleccionar columnas (select)</a></li>
<li><a class="nav-link" href="#extraer-columnas-pull"><span class="header-section-number">19.3.2</span> Extraer columnas (pull)</a></li>
<li><a class="nav-link" href="#renombrar-rename-y-reordenar-relocate-columnas"><span class="header-section-number">19.3.3</span> Renombrar (rename) y reordenar (relocate) columnas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#crear-nuevas-variables-mutate"><span class="header-section-number">19.4</span> Crear nuevas variables (mutate)</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#recategorizar-columnas-cut-y-case_when"><span class="header-section-number">19.4.1</span> Recategorizar columnas (cut y case_when)</a></li></ul>
</li>
<li><a class="nav-link" href="#datos-ausentes-y-outliers-drop_na-y-mutate"><span class="header-section-number">19.5</span> Datos ausentes y outliers (drop_na y mutate)</a></li>
<li><a class="nav-link" href="#visualizar-el-flujo-de-datos"><span class="header-section-number">19.6</span> Visualizar el flujo de datos</a></li>
<li><a class="nav-link" href="#ejercicios-11"><span class="header-section-number">19.7</span> 📝 Ejercicios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/master/19-tidyverse.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/dadosdelaplace/courses-ECI-2022/edit/master/19-tidyverse.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analizando datos, visualizando información, contando historias</strong>" was written by Javier Álvarez Liébana y Gabriel Valverde Castilla. It was last built on Última actualización: 27-01-2022.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
