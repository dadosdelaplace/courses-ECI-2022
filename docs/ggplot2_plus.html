<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 22 Profundizando en ggplot2 | Analizando datos, visualizando información, contando historias</title>
<meta name="author" content="Javier Álvarez Liébana y Gabriel Valverde Castilla">
<meta name="description" content="Scripts usados: script22.R: profundizando en tidyverse. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script22.R  library(tidyverse)  22.1 Personalizando el tema ...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Capítulo 22 Profundizando en ggplot2 | Analizando datos, visualizando información, contando historias">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/logo_R.png">
<meta property="og:description" content="Scripts usados: script22.R: profundizando en tidyverse. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script22.R  library(tidyverse)  22.1 Personalizando el tema ...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 22 Profundizando en ggplot2 | Analizando datos, visualizando información, contando historias">
<meta name="twitter:description" content="Scripts usados: script22.R: profundizando en tidyverse. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script22.R  library(tidyverse)  22.1 Personalizando el tema ...">
<meta name="twitter:image" content="/img/logo_R.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Sen-0.4.0/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/_Bitter-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.18/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet">
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script><script src="libs/wordcloud2-0.0.1/hover.js"></script><script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analizando datos, visualizando información, contando historias</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Recursos</li>
<li><a class="" href="ejercicios-recopilados.html">📝 Ejercicios recopilados</a></li>
<li><a class="" href="recursos-de-aprendizaje.html">📚 Recursos de aprendizaje</a></li>
<li><a class="" href="pr%C3%A1cticas-evaluables.html">🏅 Prácticas evaluables</a></li>
<li class="book-part">Toma de contacto</li>
<li><a class="" href="requisitos.html"><span class="header-section-number">1</span> Requisitos</a></li>
<li><a class="" href="instalacion.html"><span class="header-section-number">2</span> Instalación</a></li>
<li><a class="" href="que-es-R.html"><span class="header-section-number">3</span> ¿Qué es R?</a></li>
<li><a class="" href="primeros-pasos.html"><span class="header-section-number">4</span> Primeros pasos</a></li>
<li class="book-part">Conceptos básicos</li>
<li><a class="" href="tipos-datos.html"><span class="header-section-number">5</span> Tipos de datos</a></li>
<li><a class="" href="vectores.html"><span class="header-section-number">6</span> Vectores</a></li>
<li><a class="" href="operacionesvectores.html"><span class="header-section-number">7</span> Operaciones con vectores</a></li>
<li><a class="" href="datos.html"><span class="header-section-number">8</span> Datos estructurados</a></li>
<li><a class="" href="repaso-1.html"><span class="header-section-number">9</span> Repaso: empezando a trastear con datos</a></li>
<li class="book-part">Haciendo el trabajo más fácil</li>
<li><a class="" href="if-else.html"><span class="header-section-number">10</span> Estructuras de control: if-else</a></li>
<li><a class="" href="bucles.html"><span class="header-section-number">11</span> Estructuras de control: bucles</a></li>
<li><a class="" href="proyecto.html"><span class="header-section-number">12</span> Primer proyecto de trabajo</a></li>
<li><a class="" href="funciones.html"><span class="header-section-number">13</span> Funciones</a></li>
<li><a class="" href="listas.html"><span class="header-section-number">14</span> Listas</a></li>
<li class="book-part">Empezando a explorar datos</li>
<li><a class="" href="tibble.html"><span class="header-section-number">15</span> Mejorando los data.frame: datos tibble</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">16</span> Tidy vs messy data: daticos ordenados</a></li>
<li><a class="" href="importar-exportar.html"><span class="header-section-number">17</span> Sacando datos de las piedras</a></li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">18</span> Contando los datos: rmarkdown</a></li>
<li class="book-part">Incursión a tidyverse</li>
<li><a class="" href="tidyverse.html"><span class="header-section-number">19</span> Depuración y transformación</a></li>
<li><a class="" href="tidyverse-2.html"><span class="header-section-number">20</span> Profundizando tidyverse: encuestas electorales</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">21</span> Visualizando datos: incursión a ggplot2</a></li>
<li><a class="active" href="ggplot2_plus.html"><span class="header-section-number">22</span> Profundizando en ggplot2</a></li>
<li class="book-part">Incursión a la estadística descriptiva</li>
<li><a class="" href="descriptiva_cualitativas.html"><span class="header-section-number">23</span> Extrayendo información: estadística descriptiva con cualitativas</a></li>
<li><a class="" href="descriptiva_cuantitativas.html"><span class="header-section-number">24</span> Extrayendo información: estadística descriptiva con cuantitativas continuas</a></li>
<li><a class="" href="resumenes.html"><span class="header-section-number">25</span> Resumiendo y relacionado datos</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliografía</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/dadosdelaplace/courses-ECI-2022">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot2_plus" class="section level1">
<h1>
<span class="header-section-number">Capítulo 22</span> Profundizando en ggplot2<a class="anchor" aria-label="anchor" href="#ggplot2_plus"><i class="fas fa-link"></i></a>
</h1>
<div class="blackbox">
<p>Scripts usados:</p>
<ul>
<li>
<a href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script22.R"><strong>script22.R</strong></a>: profundizando en tidyverse. Ver en <a href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script22.R" class="uri">https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script22.R</a>
</li>
</ul>
</div>
<div class="sourceCode" id="cb1933"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div id="personalizando-el-tema" class="section level2">
<h2>
<span class="header-section-number">22.1</span> Personalizando el tema<a class="anchor" aria-label="anchor" href="#personalizando-el-tema"><i class="fas fa-link"></i></a>
</h2>
<div id="datos-1" class="section level3">
<h3>
<span class="header-section-number">22.1.1</span> Datos<a class="anchor" aria-label="anchor" href="#datos-1"><i class="fas fa-link"></i></a>
</h3>
<p>En est ocasión vamos a usar los <mark><strong>datos de Netflix</strong></mark> proporcionados por Paula Casado en <a href="https://elartedeldato.com/blog/como-anadir-una-anotacion-en-ggplot/">El Arte del Dato</a>, página en la que se basará esta visualización: visualizaremos el número de películas y series de instituto que se han estrenado en Netflix en cada año.</p>
<div class="sourceCode" id="cb1934"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">netflix</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/elartedeldato/datasets/main/netflix_titles.csv'</span><span class="op">)</span>
<span class="va">netflix</span></code></pre></div>
<pre><code>## # A tibble: 7,787 × 12
##    show_id type    title director  cast   country date_added release_year rating
##    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; 
##  1 s1      TV Show 3%    &lt;NA&gt;      João … Brazil  August 14…         2020 TV-MA 
##  2 s2      Movie   7:19  Jorge Mi… Demiá… Mexico  December …         2016 TV-MA 
##  3 s3      Movie   23:59 Gilbert … Tedd … Singap… December …         2011 R     
##  4 s4      Movie   9     Shane Ac… Elija… United… November …         2009 PG-13 
##  5 s5      Movie   21    Robert L… Jim S… United… January 1…         2008 PG-13 
##  6 s6      TV Show 46    Serdar A… Erdal… Turkey  July 1, 2…         2016 TV-MA 
##  7 s7      Movie   122   Yasir Al… Amina… Egypt   June 1, 2…         2019 TV-MA 
##  8 s8      Movie   187   Kevin Re… Samue… United… November …         1997 R     
##  9 s9      Movie   706   Shravan … Divya… India   April 1, …         2019 TV-14 
## 10 s10     Movie   1920  Vikram B… Rajne… India   December …         2008 TV-MA 
## # … with 7,777 more rows, and 3 more variables: duration &lt;chr&gt;,
## #   listed_in &lt;chr&gt;, description &lt;chr&gt;</code></pre>
<p>Los datos provienen originalmente de <a href="https://www.kaggle.com/shivamb/netflix-shows">Kaggle</a>, y contienen las <mark><strong>películas y series de Netflix</strong></mark> hasta enero de 2021. Para visualizar vamos a filtrar las <mark><strong>películas y series de instituto</strong></mark>, usando la función <code><a href="https://rdrr.io/pkg/stringr/man/str_detect.html">str_detect()</a></code> (del paquete <a href="http://stringr.tidyverse.org">stringr</a>), que nos devolverá <code>TRUE</code> si detecta en la variable <code>description</code> (pasándola a mayúsculas) el patrón de texto <code>"HIGH SCHOOL"</code>.</p>
<div class="sourceCode" id="cb1936"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">netflix_hs</span> <span class="op">&lt;-</span> <span class="va">netflix</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="va">description</span><span class="op">)</span>, <span class="st">"HIGH SCHOOL"</span><span class="op">)</span><span class="op">)</span>
<span class="va">netflix_hs</span> </code></pre></div>
<pre><code>## # A tibble: 150 × 12
##    show_id type  title   director cast    country date_added release_year rating
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; 
##  1 s8      Movie 187     Kevin R… Samuel… United… November …         1997 R     
##  2 s32     Movie #Frien… Rako Pr… Adipat… Indone… May 21, 2…         2018 TV-G  
##  3 s34     Movie #reali… Fernand… Nesta … United… September…         2017 TV-14 
##  4 s47     Movie 1 Chan… Adam De… Lexi G… United… July 1, 2…         2014 TV-PG 
##  5 s48     Movie 1 Mile… Leif Ti… Billy … United… July 7, 2…         2017 TV-14 
##  6 s56     Movie 100 Th… &lt;NA&gt;     Isabel… United… November …         2014 TV-Y  
##  7 s58     Movie 100% H… Jastis … Anisa … Indone… January 7…         2020 TV-14 
##  8 s148    Movie A Baby… Rachel … Tamara… United… October 1…         2020 TV-PG 
##  9 s251    Movie A Walk… Adam Sh… Mandy … United… July 1, 2…         2002 PG    
## 10 s297    Movie Across… Julien … Sarah … Canada  April 1, …         2015 TV-MA 
## # … with 140 more rows, and 3 more variables: duration &lt;chr&gt;, listed_in &lt;chr&gt;,
## #   description &lt;chr&gt;</code></pre>
<p>Tras dicho filtro vamos a añadir el <mark><strong>año en el que se estrenó</strong></mark>, con la función <code><a href="https://rdrr.io/pkg/lubridate/man/year.html">year()</a></code> de <a href="https://lubridate.tidyverse.org">lubridate</a>, que nos devuelve el año de una fecha concreta. Esa fecha concreta la vamos a construir con <code><a href="https://rdrr.io/pkg/lubridate/man/ymd.html">mdy()</a></code>.</p>
<div class="sourceCode" id="cb1938"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/lubridate/man/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"August 26, 2016"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2016-08-26"</code></pre>
<div class="sourceCode" id="cb1940"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">netflix_final</span> <span class="op">&lt;-</span> 
  <span class="va">netflix_hs</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lubridate/man/year.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lubridate/man/ymd.html">mdy</a></span><span class="op">(</span><span class="va">date_added</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Como ves en <code>netflix_final</code> hemos <mark><strong>eliminado</strong></mark> aquellos registros de los que no tengamos su año de estreno.</p>
</div>
<div id="diagrama-de-barras" class="section level3">
<h3>
<span class="header-section-number">22.1.2</span> Diagrama de barras<a class="anchor" aria-label="anchor" href="#diagrama-de-barras"><i class="fas fa-link"></i></a>
</h3>
<p>Tras la depuración vamos a</p>
<ul>
<li>agrupar por año con <code><a href="https://rdrr.io/pkg/dplyr/man/group_by.html">group_by(year)</a></code>
</li>
<li>contar el número de elementos en cada uno con <code><a href="https://rdrr.io/pkg/dplyr/man/count.html">count()</a></code>
</li>
</ul>
<div class="sourceCode" id="cb1941"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">netflix_resumen</span> <span class="op">&lt;-</span> 
  <span class="va">netflix_final</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">netflix_resumen</span></code></pre></div>
<pre><code>## # A tibble: 9 × 2
##    year     n
##   &lt;dbl&gt; &lt;int&gt;
## 1  2011     2
## 2  2013     1
## 3  2015     1
## 4  2016     6
## 5  2017    18
## 6  2018    28
## 7  2019    42
## 8  2020    46
## 9  2021     6</code></pre>
<p>Con estos datos ya estamos condiciones de poder hacer nuestro diagrama de barras.</p>
<div class="sourceCode" id="cb1943"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">netflix_resumen</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-760-1.png" width="768"></div>
</div>
<div id="modificando-la-escala-de-los-ejes" class="section level3">
<h3>
<span class="header-section-number">22.1.3</span> Modificando la escala de los ejes<a class="anchor" aria-label="anchor" href="#modificando-la-escala-de-los-ejes"><i class="fas fa-link"></i></a>
</h3>
<p>Si te fijas solo nos ha mostrado algunos años en el eje X, así le vamos a indicar la <mark><strong>escala concreta</strong></mark> que queremos en dicho eje con <code><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous()</a></code>, usando el argumento <code>breaks</code> en el que le indicaremos los valores donde queremos que «corte» el eje X (los corte serán los años guardados en <code>netflix_resumen$year</code>)</p>
<div class="sourceCode" id="cb1944"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">netflix_resumen</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">netflix_resumen</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-761-1.png" width="768"></div>
<p>Cuando uno de los <mark><strong>ejes representa una fecha</strong></mark> podemos indicárselo con <code><a href="https://rdrr.io/pkg/ggplot2/man/scale_date.html">scale_x_date()</a></code>, asigándole en <code>date_breaks</code> el lapso temporal que queremos en las marcas (por ejemplo, <code>date_breaks = '1 month'</code>). Como ejemplo, vamos a visualizar el número de películas y series generales estrenadas en Netflix desde el 1 de julio de 2020.</p>
<div class="sourceCode" id="cb1945"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">netflix</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>date_added <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lubridate/man/ymd.html">mdy</a></span><span class="op">(</span><span class="va">date_added</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_added</span><span class="op">)</span> <span class="op">&amp;</span>
                  <span class="va">date_added</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-07-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date_added</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/count.html">count</a></span><span class="op">(</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_added</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">'1 month'</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-762-1.png" width="768"></div>
</div>
<div id="personalizando-tema" class="section level3">
<h3>
<span class="header-section-number">22.1.4</span> Personalizando tema<a class="anchor" aria-label="anchor" href="#personalizando-tema"><i class="fas fa-link"></i></a>
</h3>
<p>Lo primero que vamos a hacer es <mark><strong>añadir título y otras opciones</strong></mark> del tema que ya conocemos.</p>
<div class="sourceCode" id="cb1946"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">netflix_resumen</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">netflix_resumen</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NETFLIX"</span>,
       subtitle <span class="op">=</span> <span class="st">"Películas y series de instituto"</span>,
       caption <span class="op">=</span> <span class="st">"Basada en El Arte del Dato (https://elartedeldato.com) | Datos: Kaggle"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-763-1.png" width="768"></div>
<p>En este caso, al ser datos de Netflix, la propia palabara de es una marca por sí misma, y quizás nos interese <mark><strong>usar alguna fuente de Google</strong></mark> para cambiar la fuente por defecto. En este caso vamos a usar la fuente de Netflix, la fuente <code>Bebas Neue</code>, y para poder usarla usaremos <code><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google()</a></code></p>
<div class="sourceCode" id="cb1947"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/sysfonts">sysfonts</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext">showtext</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Bebas Neue"</span>,
                name <span class="op">=</span> <span class="st">"Bebas Neue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html">showtext_auto</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Tras ello vamos a <mark><strong>personalizar totalmente nuestro tema</strong></mark>. Lo primero que haremos será «resetear» el tema que podamos tener por defecto con <code><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_void()</a></code>. Tras dicho reseteo, le indicaremos con <code><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme()</a></code></p>
<ul>
<li>
<code>legend.position = "none"</code>: sin leyenda.</li>
<li>
<code>plot.title = element_text(family = "Bebas Neue", color = "red", size = 50)</code>: le indicaremos la fuente, el color y el tamaño de nuestro título.</li>
</ul>
<div class="sourceCode" id="cb1948"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">netflix_resumen</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">netflix_resumen</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Bebas Neue"</span>,
                                  color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">80</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NETFLIX"</span>,
       subtitle <span class="op">=</span> <span class="st">"Películas y series de instituto"</span>,
       caption <span class="op">=</span> <span class="st">"Basada en El Arte del Dato (https://elartedeldato.com) | Datos: Kaggle"</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-765-1.png" width="768"></div>
<p>Ahora el título <code>"NETFLIX"</code> está en la fuente de la propia marca, lo que hace nuestro gráfico tenga un contexto más allá de la mera estadística: está intentando comunicar algo y <mark><strong>llamar la atención con un esquema visual conocido</strong></mark>.</p>
<p>Tras cambiar la fuente del título vamos a indicarle que el fondo del gráfico sea todo negro.</p>
<div class="sourceCode" id="cb1949"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> 
  <span class="va">gg</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
        plot.background <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span>, 
                                       color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-766-1.png" width="768"></div>
<p>También vamos a personalizar el grid horizontal (el que marca las alturas del eje y), indicándole color y tamaño.</p>
<div class="sourceCode" id="cb1950"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>panel.grid.major.y <span class="op">=</span>
          <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-767-1.png" width="768"></div>
<p>Vamos a personalizar también la <mark><strong>fuente del subtítulo y caption</strong></mark> y los textos de los ejes.</p>
<div class="sourceCode" id="cb1951"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Permanent Marker"</span>,
                name <span class="op">=</span> <span class="st">"Permanent Marker"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html">showtext_auto</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Permanent Marker"</span>,
                                     size <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,
        plot.caption <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Permanent Marker"</span>,
                                     color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">19</span><span class="op">)</span>,
        axis.text <span class="op">=</span> 
          <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span>, family <span class="op">=</span> <span class="st">"Permanent Marker"</span>,
                       color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-768-1.png" width="768"></div>
<p>Por último vamos a darle un poco de aire <mark><strong>añadiendo márgenes</strong></mark></p>
<div class="sourceCode" id="cb1952"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">4</span>, r <span class="op">=</span> <span class="fl">4</span>, b <span class="op">=</span> <span class="fl">4</span>, l <span class="op">=</span> <span class="fl">8</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-769-1.png" width="768"></div>
<p>Por último con <code><a href="https://rdrr.io/pkg/ggplot2/man/annotate.html">annotate()</a></code> podemos añadir anotaciones al gráfico, por ejemplo, escribiendo el mes de enero en la última barra para remarcar que solo llega hasta enero de 2021, con una fina curva como «flecha».</p>
<div class="sourceCode" id="cb1953"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span>  <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"(hasta enero)"</span>, 
           x <span class="op">=</span> <span class="fl">2021</span>, y <span class="op">=</span> <span class="fl">11</span>, hjust <span class="op">=</span> <span class="fl">0.3</span>, vjust <span class="op">=</span> <span class="fl">0</span>, family <span class="op">=</span> <span class="st">"Permanent Marker"</span>, size <span class="op">=</span> <span class="fl">5</span>, color<span class="op">=</span><span class="st">'white'</span>, angle <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"curve"</span>, x <span class="op">=</span> <span class="fl">2021</span>, y <span class="op">=</span> <span class="fl">9</span>, xend <span class="op">=</span> <span class="fl">2021</span>, yend <span class="op">=</span> <span class="fl">5</span>,
           color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-770-1.png" width="768"></div>
<p>Hemos pasado de un gráfico de barras cualquiera a un gráfico que ya solo por la estética nos lleva automáticamente a Netflix. Puedes ver más gráficas y trucos en la web de Paula Casado <a href="https://elartedeldato.com/"><strong>El Arte del Dato</strong></a>, de donde ha salido parte de la idea de este capítulo.</p>
</div>
</div>
<div id="gráficos-en-coordenadas-polares" class="section level2">
<h2>
<span class="header-section-number">22.2</span> Gráficos en coordenadas polares<a class="anchor" aria-label="anchor" href="#gr%C3%A1ficos-en-coordenadas-polares"><i class="fas fa-link"></i></a>
</h2>
<p>«Florence, sé enfermera», 1837. Dios no sabía que se anunciaba a la mujer que cambió la visualización de datos.</p>
<p><mark><strong>Florence Nightingale</strong></mark> (nacida en 1820 en Toscana), tras formarse en la Kaiserswerth luterana en el cuidado de marginados, fue enviada el 21 de octubre de 1854 para mejorar las <mark><strong>condiciones sanitarias de los soldados británicos en la guerra de Crimea (1854-1856)</strong></mark>.</p>
<p>Horrorizada, Florence observó las condiciones en las que se atendía a los soldados heridos. De esa observación contabilizó una <mark><strong>tasa de mortalidad de 1174 por cada 10 000 soldados</strong></mark>: 1023 se debía a enfermedades infecciosas. A su regreso a Londres se dedicó a reunir estadísticas para demostrar que los soldados fallecían por las condiciones sanitarias: eran muertes evitables.</p>
<p><mark><strong>¿Cómo demostrar algo así a tus superiores cuando era vista como una mera niñera de enfermos?</strong></mark> «Lograr a través de los ojos lo que no somos capaces de transmitir a las mentes de los ciudadanos a través de sus oídos insensibles». A través de la visualización de datos</p>
<p>Es en ese momento cuando creó el famoso <mark><strong>diagrama de la Rosa o de área polar</strong></mark>.</p>
<p>El gráfico fue una absoluta revolución ya que permitía representar tres variables a la vez:</p>
<ul>
<li>
<strong>tiempo</strong> (cada gajo es un mes)</li>
<li>
<strong>nº de muertes</strong> (área del gajo)</li>
<li>
<strong>causa de la muerte</strong> (color del gajo): azules para enfermedades infecciosas, rojas para heridas, negras para otras causas.</li>
</ul>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:florence"></span>
<img src="img/rosa_nightingale.jpg" alt="Gráfico original de Florence Nightingale" width="50%"><p class="caption">
Imagen/gráfica 22.1: Gráfico original de Florence Nightingale
</p>
</div>
<p>Florence quería demostrar que el enorme nº de bajas debidas a enfermedades infecciosas era <mark><strong>evitable</strong></mark> y así lo hizo con el gráfico de la izquierda, comparado con el de la derecha: al margen de junio de 1855, el % de muertes por enfermedades (área azul) descendió tras sus medidas para mejorar las condiciones de los hospitales.</p>
<p>El 8 de febrero de 1955, The Times la describió como la <mark><strong>«ángel guardián» de los hospitales</strong></mark>, y al finalizar la contienda, fue recibida como una heroína, conocida como <mark><strong>«The Lady with the Lamp» tras un poema de H. W. Longfellow</strong></mark> publicado en 1857. Años después se convirtió en la primera mujer en la Royal Statistical Society y renunció a su puesto para crear las primeras escuelas de enfermería.</p>
<p> </p>
<p>Vamos a intentar recrear su brillante visualización. Los datos los podemos obtener de un paquete muy interesante con datos relacionados con eventos de la <mark><strong>historia de la estadística y dataviz</strong></mark>, el paquete <code>{HistData}</code>, y el conjunto <code>Nightingale</code></p>
<div class="sourceCode" id="cb1954"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">HistData</span><span class="op">)</span>
<span class="va">Nightingale</span></code></pre></div>
<pre><code>##          Date Month Year  Army Disease Wounds Other Disease.rate Wounds.rate
## 1  1854-04-01   Apr 1854  8571       1      0     5          1.4         0.0
## 2  1854-05-01   May 1854 23333      12      0     9          6.2         0.0
## 3  1854-06-01   Jun 1854 28333      11      0     6          4.7         0.0
## 4  1854-07-01   Jul 1854 28722     359      0    23        150.0         0.0
## 5  1854-08-01   Aug 1854 30246     828      1    30        328.5         0.4
## 6  1854-09-01   Sep 1854 30290     788     81    70        312.2        32.1
## 7  1854-10-01   Oct 1854 30643     503    132   128        197.0        51.7
## 8  1854-11-01   Nov 1854 29736     844    287   106        340.6       115.8
## 9  1854-12-01   Dec 1854 32779    1725    114   131        631.5        41.7
## 10 1855-01-01   Jan 1855 32393    2761     83   324       1022.8        30.7
## 11 1855-02-01   Feb 1855 30919    2120     42   361        822.8        16.3
## 12 1855-03-01   Mar 1855 30107    1205     32   172        480.3        12.8
## 13 1855-04-01   Apr 1855 32252     477     48    57        177.5        17.9
## 14 1855-05-01   May 1855 35473     508     49    37        171.8        16.6
## 15 1855-06-01   Jun 1855 38863     802    209    31        247.6        64.5
## 16 1855-07-01   Jul 1855 42647     382    134    33        107.5        37.7
## 17 1855-08-01   Aug 1855 44614     483    164    25        129.9        44.1
## 18 1855-09-01   Sep 1855 47751     189    276    20         47.5        69.4
## 19 1855-10-01   Oct 1855 46852     128     53    18         32.8        13.6
## 20 1855-11-01   Nov 1855 37853     178     33    32         56.4        10.5
## 21 1855-12-01   Dec 1855 43217      91     18    28         25.3         5.0
## 22 1856-01-01   Jan 1856 44212      42      2    48         11.4         0.5
## 23 1856-02-01   Feb 1856 43485      24      0    19          6.6         0.0
## 24 1856-03-01   Mar 1856 46140      15      0    35          3.9         0.0
##    Other.rate
## 1         7.0
## 2         4.6
## 3         2.5
## 4         9.6
## 5        11.9
## 6        27.7
## 7        50.1
## 8        42.8
## 9        48.0
## 10      120.0
## 11      140.1
## 12       68.6
## 13       21.2
## 14       12.5
## 15        9.6
## 16        9.3
## 17        6.7
## 18        5.0
## 19        4.6
## 20       10.1
## 21        7.8
## 22       13.0
## 23        5.2
## 24        9.1</code></pre>
<div class="sourceCode" id="cb1956"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/pillar/man/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">Nightingale</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 24
## Columns: 10
## $ Date         &lt;date&gt; 1854-04-01, 1854-05-01, 1854-06-01, 1854-07-01, 1854-08-…
## $ Month        &lt;ord&gt; Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec, Jan, Feb, Ma…
## $ Year         &lt;int&gt; 1854, 1854, 1854, 1854, 1854, 1854, 1854, 1854, 1854, 185…
## $ Army         &lt;int&gt; 8571, 23333, 28333, 28722, 30246, 30290, 30643, 29736, 32…
## $ Disease      &lt;int&gt; 1, 12, 11, 359, 828, 788, 503, 844, 1725, 2761, 2120, 120…
## $ Wounds       &lt;int&gt; 0, 0, 0, 0, 1, 81, 132, 287, 114, 83, 42, 32, 48, 49, 209…
## $ Other        &lt;int&gt; 5, 9, 6, 23, 30, 70, 128, 106, 131, 324, 361, 172, 57, 37…
## $ Disease.rate &lt;dbl&gt; 1.4, 6.2, 4.7, 150.0, 328.5, 312.2, 197.0, 340.6, 631.5, …
## $ Wounds.rate  &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.4, 32.1, 51.7, 115.8, 41.7, 30.7, 1…
## $ Other.rate   &lt;dbl&gt; 7.0, 4.6, 2.5, 9.6, 11.9, 27.7, 50.1, 42.8, 48.0, 120.0, …</code></pre>
<p>De los datos solo nos interesan las variables de fecha <code>Date, Month, Year</code> y las tasas relativas (que contienen <code>"rate"</code> en el nombre).</p>
<div class="sourceCode" id="cb1958"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos</span> <span class="op">&lt;-</span>
  <span class="va">Nightingale</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Month</span>, <span class="va">Year</span>, <span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"rate"</span><span class="op">)</span><span class="op">)</span>
<span class="va">datos</span></code></pre></div>
<pre><code>##          Date Month Year Disease.rate Wounds.rate Other.rate
## 1  1854-04-01   Apr 1854          1.4         0.0        7.0
## 2  1854-05-01   May 1854          6.2         0.0        4.6
## 3  1854-06-01   Jun 1854          4.7         0.0        2.5
## 4  1854-07-01   Jul 1854        150.0         0.0        9.6
## 5  1854-08-01   Aug 1854        328.5         0.4       11.9
## 6  1854-09-01   Sep 1854        312.2        32.1       27.7
## 7  1854-10-01   Oct 1854        197.0        51.7       50.1
## 8  1854-11-01   Nov 1854        340.6       115.8       42.8
## 9  1854-12-01   Dec 1854        631.5        41.7       48.0
## 10 1855-01-01   Jan 1855       1022.8        30.7      120.0
## 11 1855-02-01   Feb 1855        822.8        16.3      140.1
## 12 1855-03-01   Mar 1855        480.3        12.8       68.6
## 13 1855-04-01   Apr 1855        177.5        17.9       21.2
## 14 1855-05-01   May 1855        171.8        16.6       12.5
## 15 1855-06-01   Jun 1855        247.6        64.5        9.6
## 16 1855-07-01   Jul 1855        107.5        37.7        9.3
## 17 1855-08-01   Aug 1855        129.9        44.1        6.7
## 18 1855-09-01   Sep 1855         47.5        69.4        5.0
## 19 1855-10-01   Oct 1855         32.8        13.6        4.6
## 20 1855-11-01   Nov 1855         56.4        10.5       10.1
## 21 1855-12-01   Dec 1855         25.3         5.0        7.8
## 22 1856-01-01   Jan 1856         11.4         0.5       13.0
## 23 1856-02-01   Feb 1856          6.6         0.0        5.2
## 24 1856-03-01   Mar 1856          3.9         0.0        9.1</code></pre>
<p>Tras la selección de variables vamos a convertir los datos a <em>tidy data</em>, pasando todos los valores de tasas e mortalidad a la misma columna <code>tasa</code>, y las causas de la muerte a una columna llamada <code>causa</code>. Además renombramos las variables de fecha.</p>
<div class="sourceCode" id="cb1960"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos</span> <span class="op">&lt;-</span>
  <span class="va">datos</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">6</span>, names_to <span class="op">=</span> <span class="st">"causa"</span>,
               values_to <span class="op">=</span> <span class="st">"tasa"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename</a></span><span class="op">(</span>fecha <span class="op">=</span> <span class="va">Date</span>, mes <span class="op">=</span> <span class="va">Month</span>, year <span class="op">=</span> <span class="va">Year</span><span class="op">)</span> 
<span class="va">datos</span></code></pre></div>
<pre><code>## # A tibble: 72 × 5
##    fecha      mes    year causa         tasa
##    &lt;date&gt;     &lt;ord&gt; &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1 1854-04-01 Apr    1854 Disease.rate   1.4
##  2 1854-04-01 Apr    1854 Wounds.rate    0  
##  3 1854-04-01 Apr    1854 Other.rate     7  
##  4 1854-05-01 May    1854 Disease.rate   6.2
##  5 1854-05-01 May    1854 Wounds.rate    0  
##  6 1854-05-01 May    1854 Other.rate     4.6
##  7 1854-06-01 Jun    1854 Disease.rate   4.7
##  8 1854-06-01 Jun    1854 Wounds.rate    0  
##  9 1854-06-01 Jun    1854 Other.rate     2.5
## 10 1854-07-01 Jul    1854 Disease.rate 150  
## # … with 62 more rows</code></pre>
<p>Por último vamos a eliminar <code>".rate"</code> de las causas, y traducirlas a castellano, así como crear una nueva variable llamada <code>periodo</code> que nos dirá si fuese antes del 1 de marzo de 1855 o después (para recrear los gráficos por separado, antes y después de las intervenciones llevadas a cabo por Nightingale).</p>
<div class="sourceCode" id="cb1962"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos</span> <span class="op">&lt;-</span>
  <span class="va">datos</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>causa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".rate"</span>, <span class="st">""</span>, <span class="va">causa</span><span class="op">)</span>,
         causa <span class="op">=</span>
           <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/case_when.html">case_when</a></span><span class="op">(</span><span class="va">causa</span> <span class="op">==</span> <span class="st">"Disease"</span> <span class="op">~</span> <span class="st">"infecciosas"</span>,
                     <span class="va">causa</span> <span class="op">==</span> <span class="st">"Wounds"</span> <span class="op">~</span> <span class="st">"heridas"</span>,
                     <span class="va">causa</span> <span class="op">==</span> <span class="st">"Other"</span> <span class="op">~</span> <span class="st">"otras"</span>,
                     <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"otras"</span><span class="op">)</span>,
         periodo <span class="op">=</span>
           <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">fecha</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1855-04-01"</span><span class="op">)</span>,
                            <span class="st">"APRIL 1855 TO MARCH 1856"</span>,
                            <span class="st">"APRIL 1854 TO MARCH 1855"</span><span class="op">)</span>,
                     levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"APRIL 1855 TO MARCH 1856"</span>,
                                <span class="st">"APRIL 1854 TO MARCH 1855"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">datos</span></code></pre></div>
<pre><code>## # A tibble: 72 × 6
##    fecha      mes    year causa        tasa periodo                 
##    &lt;date&gt;     &lt;ord&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;fct&gt;                   
##  1 1854-04-01 Apr    1854 infecciosas   1.4 APRIL 1854 TO MARCH 1855
##  2 1854-04-01 Apr    1854 heridas       0   APRIL 1854 TO MARCH 1855
##  3 1854-04-01 Apr    1854 otras         7   APRIL 1854 TO MARCH 1855
##  4 1854-05-01 May    1854 infecciosas   6.2 APRIL 1854 TO MARCH 1855
##  5 1854-05-01 May    1854 heridas       0   APRIL 1854 TO MARCH 1855
##  6 1854-05-01 May    1854 otras         4.6 APRIL 1854 TO MARCH 1855
##  7 1854-06-01 Jun    1854 infecciosas   4.7 APRIL 1854 TO MARCH 1855
##  8 1854-06-01 Jun    1854 heridas       0   APRIL 1854 TO MARCH 1855
##  9 1854-06-01 Jun    1854 otras         2.5 APRIL 1854 TO MARCH 1855
## 10 1854-07-01 Jul    1854 infecciosas 150   APRIL 1854 TO MARCH 1855
## # … with 62 more rows</code></pre>
<p>La manera más inmediata de representar las tasas por causa es hacer uso de un <mark><strong>sencillo diagrama de barras apiladas</strong></mark>, cada periodo por separado, con un título, subtítulo y caption.</p>
<div class="sourceCode" id="cb1964"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">periodo</span> <span class="op">==</span> <span class="st">"APRIL 1854 TO MARCH 1855"</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">mes</span>, <span class="va">tasa</span>, fill <span class="op">=</span> <span class="va">causa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Causas"</span>,
       title <span class="op">=</span> <span class="st">"DIAGRAM OF THE CAUSES OF MORTALITY"</span>,
       subtitle <span class="op">=</span> <span class="st">"IN THE ARMY IN THE EAST (April 1854 - March 1855)"</span>,
       caption <span class="op">=</span> <span class="st">"Author: J. Álvarez Liébana | Data: HistData"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-775-1.png" width="768"></div>
<div class="sourceCode" id="cb1965"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">periodo</span> <span class="op">==</span> <span class="st">"APRIL 1855 TO MARCH 1856"</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">mes</span>, <span class="va">tasa</span>, fill <span class="op">=</span> <span class="va">causa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Causas"</span>,
       title <span class="op">=</span> <span class="st">"DIAGRAM OF THE CAUSES OF MORTALITY"</span>,
       subtitle <span class="op">=</span> <span class="st">"IN THE ARMY IN THE EAST (April 1855 - March 1856)"</span>,
       caption <span class="op">=</span> <span class="st">"Author: J. Álvarez Liébana | Data: HistData"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-776-1.png" width="768"></div>
<p>Ambos periodos podemos juntarlos en una misma gráfica con <code><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap()</a></code></p>
<div class="sourceCode" id="cb1966"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">mes</span>, <span class="va">tasa</span>, fill <span class="op">=</span> <span class="va">causa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">periodo</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Causas"</span>,
       title <span class="op">=</span> <span class="st">"DIAGRAM OF THE CAUSES OF MORTALITY"</span>,
       subtitle <span class="op">=</span> <span class="st">"IN THE ARMY IN THE EAST"</span>,
       caption <span class="op">=</span> <span class="st">"Author: J. Álvarez Liébana | Data: HistData"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-777-1.png" width="768"></div>
<p>Vamos a ir acercándonos al gráfico de Florence Nighitingale, proporcionando <mark><strong>colores similares a los originales para las causas de fallecimiento</strong></mark></p>
<div class="sourceCode" id="cb1967"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">mes</span>, <span class="va">tasa</span>, fill <span class="op">=</span> <span class="va">causa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">periodo</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span>
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#C42536"</span>, <span class="st">"#5aa7d1"</span>, <span class="st">"#6B6B6B"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Causas"</span>,
       title <span class="op">=</span> <span class="st">"DIAGRAM OF THE CAUSES OF MORTALITY"</span>,
       subtitle <span class="op">=</span> <span class="st">"IN THE ARMY IN THE EAST"</span>,
       caption <span class="op">=</span> <span class="st">"Author: J. Álvarez Liébana | Data: HistData"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-778-1.png" width="768"></div>
<p>Nuestros datos <mark><strong>abarcan dos periodos</strong></mark>: de abril 1854 a marzo 1855, y de abril 1855 a marzo 1856. Para tener los datos ordenados cronológicamente, vamos a indicarle que el año irá desde abril a marzo, en ese orden los meses, con <code>fct_relevel</code>, del paquete <a href="https://forcats.tidyverse.org">forcats</a> incluido en <a href="https://tidyverse.tidyverse.org">tidyverse</a>.</p>
<div class="sourceCode" id="cb1968"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos</span> <span class="op">&lt;-</span> 
  <span class="va">datos</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>mes <span class="op">=</span>
           <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">mes</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>, <span class="st">"Jul"</span>,
                       <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>,
                       <span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span><span class="op">)</span><span class="op">)</span>

<span class="va">gg</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">mes</span>, <span class="va">tasa</span>, fill <span class="op">=</span> <span class="va">causa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">periodo</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span>
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#C42536"</span>, <span class="st">"#5aa7d1"</span>, <span class="st">"#6B6B6B"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Causas"</span>,
       title <span class="op">=</span> <span class="st">"DIAGRAM OF THE CAUSES OF MORTALITY"</span>,
       subtitle <span class="op">=</span> <span class="st">"IN THE ARMY IN THE EAST"</span>,
       caption <span class="op">=</span> <span class="st">"Author: J. Álvarez Liébana | Data: HistData"</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-779-1.png" width="768"></div>
<p>Como habrás advertido, el gráfico original está en <mark><strong>coordenadas polares</strong></mark>, coordenadas en torno a un círculo. Para convertir nuestro gráfico a coordenadas polares basta con usar <code><a href="https://rdrr.io/pkg/ggplot2/man/coord_polar.html">coord_polar()</a></code>. Además los meses originales están desde julio hasta junio ordenados cronológicamente.</p>
<div class="sourceCode" id="cb1969"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos</span> <span class="op">&lt;-</span> 
  <span class="va">datos</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>mes <span class="op">=</span>
           <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">mes</span>, <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>,
                       <span class="st">"Nov"</span>, <span class="st">"Dec"</span>, <span class="st">"Jan"</span>, <span class="st">"Feb"</span>,
                       <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">mes</span>, <span class="va">tasa</span>, fill <span class="op">=</span> <span class="va">causa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span>
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#C42536"</span>, <span class="st">"#5aa7d1"</span>, <span class="st">"#6B6B6B"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">periodo</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Causas"</span>,
       title <span class="op">=</span> <span class="st">"DIAGRAM OF THE CAUSES OF MORTALITY"</span>,
       subtitle <span class="op">=</span> <span class="st">"IN THE ARMY IN THE EAST"</span>,
       caption <span class="op">=</span> <span class="st">"Author: J. Álvarez Liébana | Data: HistData"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-780-1.png" width="768"></div>
<p>Dado que en el gráfico original no hay marcas en el eje Y, vamos eliminar el eje Y, vamos a darle etiquetas correctas a los meses (como en el original), y vamos a cambiar la escala del eje Y con <code><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_y_sqrt()</a></code> (para que las diferencias no sean tan exageradas entre un círculo y otro por la escala).</p>
<div class="sourceCode" id="cb1970"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">mes</span>, <span class="va">tasa</span>, fill <span class="op">=</span> <span class="va">causa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span>
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#C42536"</span>, <span class="st">"#5aa7d1"</span>, <span class="st">"#6B6B6B"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_y_sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span>
                     <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"JULY"</span>, <span class="st">"AUGUST"</span>, <span class="st">"SEPT."</span>,
                       <span class="st">"OCTOBER"</span>, <span class="st">"NOVEMBER"</span>, <span class="st">"DECEMBER"</span>,
                       <span class="st">"JANUARY"</span>, <span class="st">"FEBRUARY"</span>, <span class="st">"MARCH"</span>,
                       <span class="st">"APRIL"</span>, <span class="st">"MAY"</span>, <span class="st">"JUNE"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">periodo</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Causas"</span>,
       title <span class="op">=</span> <span class="st">"DIAGRAM OF THE CAUSES OF MORTALITY"</span>,
       subtitle <span class="op">=</span> <span class="st">"IN THE ARMY IN THE EAST"</span>,
       caption <span class="op">=</span> <span class="st">"Author: J. Álvarez Liébana | Data: HistData"</span><span class="op">)</span> 
<span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
           axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
           axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-781-1.png" width="768"></div>
<p>Por último podemos personalizar el fondo, los ejes, los títulos, el ángulo de las etiquetas de los meses, etc.</p>
<div class="sourceCode" id="cb1971"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/sysfonts">sysfonts</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext">showtext</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>,
                name <span class="op">=</span> <span class="st">"Roboto"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Cinzel Decorative"</span>,
                name <span class="op">=</span> <span class="st">"Cinzel Decorative"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Quattrocento"</span>,
                name <span class="op">=</span> <span class="st">"Quattrocento"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html">showtext_auto</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">angulo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="op">-</span><span class="fl">340</span>, length.out <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>
<span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>
    <span class="co"># Eje y limpio</span>
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="co"># Eje x (el radial)</span>
    axis.text.x <span class="op">=</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">9</span>, angle <span class="op">=</span> <span class="va">angulo</span>,
                   family <span class="op">=</span> <span class="st">"Roboto"</span><span class="op">)</span>,
    panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.01</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    plot.background <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/scales/man/alpha.html">alpha</a></span><span class="op">(</span><span class="st">"cornsilk"</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,
    plot.title <span class="op">=</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">21</span>,
                   family <span class="op">=</span> <span class="st">"Cinzel Decorative"</span><span class="op">)</span>,
    plot.subtitle <span class="op">=</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">15</span>,
                   family <span class="op">=</span> <span class="st">"Cinzel Decorative"</span><span class="op">)</span>,
    plot.caption <span class="op">=</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span>, family <span class="op">=</span> <span class="st">"Quattrocento"</span><span class="op">)</span>,
    strip.text <span class="op">=</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">7</span>,
                   family <span class="op">=</span> <span class="st">"Quattrocento"</span><span class="op">)</span>,
    plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">5</span>, r <span class="op">=</span> <span class="fl">7</span>, b <span class="op">=</span> <span class="fl">5</span>, l <span class="op">=</span> <span class="fl">7</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-782-1.png" width="768"></div>
</div>
<div id="recursos-para-seguir-profundizando" class="section level2">
<h2>
<span class="header-section-number">22.3</span> Recursos para seguir profundizando<a class="anchor" aria-label="anchor" href="#recursos-para-seguir-profundizando"><i class="fas fa-link"></i></a>
</h2>
<p>En la web de Paula Casado <a href="https://elartedeldato.com/">El Arte del Dato</a> puedes encontrar tutoriales cortos y sencillos con multitud de trucos para personalizar tus gráficas. En la web <a href="https://www.r-graph-gallery.com/" class="uri">https://www.r-graph-gallery.com/</a> tienes una colección muy completa de gráficos generados en <a href="https://ggplot2.tidyverse.org">ggplot2</a> para aprender y tomar ideas.</p>
</div>
<div id="ejercicios-13" class="section level2">
<h2>
<span class="header-section-number">22.4</span> 📝 Ejercicios<a class="anchor" aria-label="anchor" href="#ejercicios-13"><i class="fas fa-link"></i></a>
</h2>
<p>(haz click en las flechas para ver soluciones)</p>
<p>El ejercicio está basado en el gráfico de <a href="https://tobias-stalder.netlify.app/">Tobias Stadler</a>, cuyo código original puedes encontrarlo en <a href="https://github.com/toebR/Tidy-Tuesday/blob/master/hiking/script.R">Github</a>, al tutorial de <a href="https://tcapretto.netlify.app/">Tomás Capretto</a> y al material en <a href="https://www.r-graph-gallery.com/web-circular-barplot-with-R-and-ggplot2.html">R Graph Gallery</a>.</p>
<p>Se ruega citar la autoría del gráfico añadiendo el siguiente <code>caption</code></p>
<div class="sourceCode" id="cb1972"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">caption_chart</span> <span class="op">&lt;-</span> <span class="st">"Dataviz by Tobias Stalder\ntobias-stalder.netlify.app\nSource: TidyX Crew (Ellis Hughes, Patrick Ward)\n Data: github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-11-24/readme.md"</span></code></pre></div>
<p>Los datos provienen originalmente de la «Washington Trails Association», con datos de sendas de senderismo en Washington. Tienes el archivo <code>hiking.csv</code> en la carpeta <code>DATOS</code>. Los datos han sido descargados desde <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-11-24" class="uri">https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-11-24</a></p>
<details><p><summary>📝<strong>Ejercicio 1</strong>: carga los datos <code>hiking.csv</code> y muestra las variables.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1973"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="va">hike_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"./DATOS/hiking.csv"</span><span class="op">)</span>
<span class="va">hike_data</span> </code></pre></div>
<pre><code>## # A tibble: 1,958 × 8
##    name    location     length   gain highpoint rating features description     
##    &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;   &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;    &lt;chr&gt;           
##  1 Lake H… Puget Sound… 2.3 mi…    50       330   3.67 NA       "Hike through a…
##  2 Snow L… Snoqualmie … 7.2 mi…  1800      4400   4.16 NA       "A relatively s…
##  3 Skooku… Mount Raini… 7.8 mi…   300      2550   3.68 NA       "Choose between…
##  4 Teneri… Snoqualmie … 5.6 mi…  1585      2370   3.92 NA       "You'll work up…
##  5 Twin F… Snoqualmie … 2.6 mi…   500      1000   4.14 NA       "Visit a trio (…
##  6 Chenui… Mount Raini… 8.0 mi…   500      2200   3.14 NA       "A long walk (o…
##  7 Old Mi… Mount Raini… 3.4 mi…   425      2150   5    NA       "An infrequentl…
##  8 Flamin… Puget Sound… 4.0 mi…   450       425   2.68 NA       "The striking n…
##  9 Salmon… North Casca… 5.4 mi…   300      2400   4    NA       "With gentle te…
## 10 May Va… Issaquah Al… 6.6 mi…  1684      2024   2.96 NA       "This forested …
## # … with 1,948 more rows</code></pre>
<div class="sourceCode" id="cb1975"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/pillar/man/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">hike_data</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 1,958
## Columns: 8
## $ name        &lt;chr&gt; "Lake Hills Greenbelt", "Snow Lake", "Skookum Flats", "Ten…
## $ location    &lt;chr&gt; "Puget Sound and Islands -- Seattle-Tacoma Area", "Snoqual…
## $ length      &lt;chr&gt; "2.3 miles, roundtrip", "7.2 miles, roundtrip", "7.8 miles…
## $ gain        &lt;dbl&gt; 50, 1800, 300, 1585, 500, 500, 425, 450, 300, 1684, 80, 65…
## $ highpoint   &lt;dbl&gt; 330, 4400, 2550, 2370, 1000, 2200, 2150, 425, 2400, 2024, …
## $ rating      &lt;dbl&gt; 3.67, 4.16, 3.68, 3.92, 4.14, 3.14, 5.00, 2.68, 4.00, 2.96…
## $ features    &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ description &lt;chr&gt; "Hike through a pastoral area first settled and farmed in …</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 2</strong>: transforma la variable <code>location</code> para obtener la region (es la primera palabra, antes del <code>" -- "</code>. Para ello puedes usar la función <code><a href="https://rdrr.io/pkg/stringr/man/word.html">word()</a></code>, que nos permite seleccionar la palabra enésima de una frase, indicándole en <code>sep = ...</code> el separado entre palabra y palabra. Conviértela a factor la nueva variable <code>region</code>.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1977"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hike_data</span> <span class="op">&lt;-</span>
  <span class="va">hike_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stringr/man/word.html">word</a></span><span class="op">(</span><span class="va">location</span>, <span class="fl">1</span>, sep <span class="op">=</span> <span class="st">" -- "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 3</strong>: transforma la variable <code>length</code> para obtener la longitud en millas de la ruta. Está en formato <code>"12.7 miles, roundtrip"</code>, así que puedes volver a usar la función <code><a href="https://rdrr.io/pkg/stringr/man/word.html">word()</a></code>, y pasar luego la cadena de texto a número.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1978"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hike_data</span> <span class="op">&lt;-</span>
  <span class="va">hike_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>miles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stringr/man/word.html">word</a></span><span class="op">(</span><span class="va">length</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 4</strong>: calcula la longitud total (acumulada) y la media de desnivel (<code>gain</code>), con las rutas agrupadas por la variable <code>region</code>, así como el número de rutas por región. </summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1979"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resumen</span> <span class="op">&lt;-</span>
  <span class="va">hike_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/group_by.html">group_by</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html">summarise</a></span><span class="op">(</span>sum_miles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">miles</span><span class="op">)</span>,
            mean_gain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">gain</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
            n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">resumen</span></code></pre></div>
<pre><code>## # A tibble: 11 × 4
##    region                  sum_miles mean_gain     n
##    &lt;fct&gt;                       &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 Puget Sound and Islands      810.       452   191
##  2 Snoqualmie Region           1915.      2206   219
##  3 Mount Rainier Area          1602.      1874   196
##  4 North Cascades              3347.      2500   301
##  5 Issaquah Alps                383.       973    77
##  6 Central Washington           453.       814    80
##  7 South Cascades              1630.      1649   193
##  8 Central Cascades            2131.      2260   226
##  9 Southwest Washington         825.      1185   123
## 10 Olympic Peninsula           1700.      1572   209
## 11 Eastern Washington          1334.      1591   143</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 5</strong>: dibuja un diagrama de barras con la región en el eje X, la suma de millas en el eje Y y el relleno en función del número de rutas. </summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1981"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">resumen</span>,
       <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">region</span>, y <span class="op">=</span> <span class="va">sum_miles</span>, fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="va">caption_chart</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-788-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 6</strong>: repite el ejercicio anterior pero personaliza el tema dando un título a los ejes y una fuente de tamaño adecuada para el eje X. Usa la función <code><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap()</a></code> para convertir los nombres de regiones en párrafos con salto de línea, indicándole en <code>width</code> la anchura máxima (no romperá palabras a mitad).</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1982"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">resumen</span>,
       <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, width <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
           y <span class="op">=</span> <span class="va">sum_miles</span>, fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="va">caption_chart</span>,
       fill <span class="op">=</span> <span class="st">"Nº de rutas"</span>,
       y <span class="op">=</span> <span class="st">"Suma acumulada de millas"</span>,
       x <span class="op">=</span> <span class="st">"Región"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,
        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,
        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-789-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 7</strong>: repite el ejercicio anterior pero usando <code><a href="https://rdrr.io/pkg/ggplot2/man/scale_gradient.html">scale_fill_gradientn()</a></code> para dar una escala de colores continua (en forma de gradiente) con cuatro colores. Introduce en <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col()</a></code> una transparencia de <code>alpha = 0.8</code></summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1983"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">resumen</span>,
       <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, width <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
           y <span class="op">=</span> <span class="va">sum_miles</span>, fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span><span class="st">"Cantidad de rutas"</span>,
                       colours <span class="op">=</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#6C5B7B"</span>, <span class="st">"#C06C84"</span>, <span class="st">"#F67280"</span>, <span class="st">"#F8B195"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="va">caption_chart</span>,
       fill <span class="op">=</span> <span class="st">"Nº de rutas"</span>,
       y <span class="op">=</span> <span class="st">"Suma acumulada de millas"</span>,
       x <span class="op">=</span> <span class="st">"Región"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,
        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,
        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-790-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 8</strong>: usa <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point()</a></code> para añadir al gráfico anterior la media de desnivel de las rutas. Pon por ejemplo <code>size = 3</code>, <code>alpha = 0.85</code> y <code>color = "gray20"</code>.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1984"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> 
  <span class="va">gg</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, <span class="fl">7</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">mean_gain</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"gray20"</span>, alpha <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-791-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 9</strong>: usa <code><a href="https://rdrr.io/pkg/ggplot2/man/coord_polar.html">coord_polar()</a></code> para convertir el gráfico anterior a coordenadas polares.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1985"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-792-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 10</strong>: usa <code><a href="https://rdrr.io/pkg/ggplot2/man/geom_segment.html">geom_segment()</a></code> para añadir líneas que vayan del centro hacía fuera, pasando por los puntos de desnivel. Hay que pensar que lo tuviésemos en vertical, indicándole la posición inicial <code>x</code> y final <code>xend</code> del segmento (en este caso, para cada región, así que <code>x = str_wrap(region, 7)</code>), y la posición inicial <code>y = 0</code> e <code>yend</code> un poco más que el máximo de desnivel.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1986"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, <span class="fl">7</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">0</span>,
                   xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, <span class="fl">7</span><span class="op">)</span>,
                   yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mean_gain</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.2</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> 
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-793-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 11</strong>: ordena los gajos en orden ascendente con <code><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder()</a></code>. </summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1987"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">resumen</span>,
       <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, width <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="va">sum_miles</span><span class="op">)</span>,
           y <span class="op">=</span> <span class="va">sum_miles</span>, fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_bar.html">geom_col</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span><span class="st">"Cantidad de rutas"</span>,
                       colours <span class="op">=</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#6C5B7B"</span>, <span class="st">"#C06C84"</span>, <span class="st">"#F67280"</span>, <span class="st">"#F8B195"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="va">caption_chart</span>,
       fill <span class="op">=</span> <span class="st">"Nº de rutas"</span>,
       y <span class="op">=</span> <span class="st">"Suma acumulada de millas"</span>,
       x <span class="op">=</span> <span class="st">"Región"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, <span class="fl">7</span><span class="op">)</span>, <span class="va">sum_miles</span><span class="op">)</span>,
                 y <span class="op">=</span> <span class="va">mean_gain</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"gray20"</span>, alpha <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, <span class="fl">7</span><span class="op">)</span>, <span class="va">sum_miles</span><span class="op">)</span>,
                   y <span class="op">=</span> <span class="fl">0</span>,
                   xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stringr/man/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">region</span>, <span class="fl">7</span><span class="op">)</span>,
                   yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mean_gain</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.2</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> 
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-794-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 12</strong>: con <code><a href="https://rdrr.io/pkg/ggplot2/man/annotate.html">annotate()</a></code> añade en uno de los gajos la indicación de que la altura hasta el punto nos indica el desnivel medio. Usaremos además la fuente <code>"Libre Caslon Text"</code>, muy similar a la del gráfico original </summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1988"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/sysfonts">sysfonts</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext">showtext</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Libre Caslon Text"</span>,
                name <span class="op">=</span> <span class="st">"Libre Caslon Text"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html">showtext_auto</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/annotate.html">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">11.2</span>, y <span class="op">=</span> <span class="fl">1500</span>, label <span class="op">=</span> <span class="st">"Desnivel medio"</span>,
           geom <span class="op">=</span> <span class="st">"text"</span>, angle <span class="op">=</span> <span class="op">-</span><span class="fl">78</span>, color <span class="op">=</span> <span class="st">"gray20"</span>,
           size <span class="op">=</span> <span class="fl">2</span>, family <span class="op">=</span> <span class="st">"Libre Caslon Text"</span><span class="op">)</span>
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-795-1.png" width="768"></div>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 13</strong>: con <code><a href="https://rdrr.io/pkg/ggplot2/man/annotate.html">annotate()</a></code> añade en uno de los gajos la indicación de que el radio del gajo nos indica la longitud acumulada de las rutas de esa región. Usaremos además la fuente <code>"Libre Caslon Text"</code>, muy similar a la del gráfico original </summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb1989"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/sysfonts">sysfonts</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext">showtext</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Libre Caslon Text"</span>,
                name <span class="op">=</span> <span class="st">"Libre Caslon Text"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html">showtext_auto</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/annotate.html">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">11</span>, y <span class="op">=</span> <span class="fl">3200</span>, label <span class="op">=</span> <span class="st">"Longitud acum."</span>,
           geom <span class="op">=</span> <span class="st">"text"</span>, angle <span class="op">=</span> <span class="fl">18</span>, color <span class="op">=</span> <span class="st">"gray20"</span>,
           size <span class="op">=</span> <span class="fl">2</span>, family <span class="op">=</span> <span class="st">"Libre Caslon Text"</span><span class="op">)</span> 
<span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-796-1.png" width="768"></div>
<!-- tocstop -->
</details><p>Por último hacemos que los gajos no empiecen del centro, y añadimos algún ajuste estético más (ver el <a href="https://www.r-graph-gallery.com/web-circular-barplot-with-R-and-ggplot2.html">post original</a>)</p>
<div class="sourceCode" id="cb1990"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1500</span>, <span class="fl">3500</span><span class="op">)</span>,
                     expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">3000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Make the guide for the fill discrete</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span>
           <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/guide_coloursteps.html">guide_colorsteps</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">11</span>, barheight <span class="op">=</span> <span class="fl">0.7</span>,
                            title.position <span class="op">=</span> <span class="st">"top"</span>,
                            title.hjust <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Senderismo en Washington"</span>,
       caption <span class="op">=</span> <span class="va">caption_chart</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray20"</span>,
                            family <span class="op">=</span> <span class="st">"Libre Caslon Text"</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
        panel.background <span class="op">=</span>
          <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="curso_R_ECI_files/figure-html/unnamed-chunk-797-1.png" width="768"></div>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="ggplot2.html"><span class="header-section-number">21</span> Visualizando datos: incursión a ggplot2</a></div>
<div class="next"><a href="descriptiva_cualitativas.html"><span class="header-section-number">23</span> Extrayendo información: estadística descriptiva con cualitativas</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot2_plus"><span class="header-section-number">22</span> Profundizando en ggplot2</a></li>
<li>
<a class="nav-link" href="#personalizando-el-tema"><span class="header-section-number">22.1</span> Personalizando el tema</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#datos-1"><span class="header-section-number">22.1.1</span> Datos</a></li>
<li><a class="nav-link" href="#diagrama-de-barras"><span class="header-section-number">22.1.2</span> Diagrama de barras</a></li>
<li><a class="nav-link" href="#modificando-la-escala-de-los-ejes"><span class="header-section-number">22.1.3</span> Modificando la escala de los ejes</a></li>
<li><a class="nav-link" href="#personalizando-tema"><span class="header-section-number">22.1.4</span> Personalizando tema</a></li>
</ul>
</li>
<li><a class="nav-link" href="#gr%C3%A1ficos-en-coordenadas-polares"><span class="header-section-number">22.2</span> Gráficos en coordenadas polares</a></li>
<li><a class="nav-link" href="#recursos-para-seguir-profundizando"><span class="header-section-number">22.3</span> Recursos para seguir profundizando</a></li>
<li><a class="nav-link" href="#ejercicios-13"><span class="header-section-number">22.4</span> 📝 Ejercicios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/master/22-ggplot2_plus.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/dadosdelaplace/courses-ECI-2022/edit/master/22-ggplot2_plus.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analizando datos, visualizando información, contando historias</strong>" was written by Javier Álvarez Liébana y Gabriel Valverde Castilla. It was last built on Última actualización: 30-01-2022.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
